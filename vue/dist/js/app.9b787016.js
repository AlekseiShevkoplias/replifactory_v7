(function(){var e={10041:function(e,t,o){"use strict";var a=o(70942);const n={id:"app"},r={class:"nav nav-tabs",id:"myTab"},i=["onClick"],l={class:"tab-content"};function s(e,t,o,s,c,d){const u=(0,a.resolveComponent)("ExperimentTab"),p=(0,a.resolveComponent)("DeviceControl"),m=(0,a.resolveComponent)("NgrokTab"),h=(0,a.resolveComponent)("HelpTab");return(0,a.openBlock)(),(0,a.createElementBlock)("div",n,[(0,a.createElementVNode)("ul",r,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(c.tabs,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("li",{class:"nav-item",key:e},[(0,a.createElementVNode)("a",{class:(0,a.normalizeClass)(["nav-link",{active:c.currentTab===e}]),href:"#",onClick:t=>c.currentTab=e},(0,a.toDisplayString)(e),11,i)])))),128))]),(0,a.createElementVNode)("div",l,["Experiment"===c.currentTab?((0,a.openBlock)(),(0,a.createBlock)(u,{key:0})):(0,a.createCommentVNode)("",!0),"Device"===c.currentTab?((0,a.openBlock)(),(0,a.createBlock)(p,{key:1})):(0,a.createCommentVNode)("",!0),"Remote"===c.currentTab?((0,a.openBlock)(),(0,a.createBlock)(m,{key:2})):(0,a.createCommentVNode)("",!0),"Help"===c.currentTab?((0,a.openBlock)(),(0,a.createBlock)(h,{key:3})):(0,a.createCommentVNode)("",!0)])])}var c=o(33907);const d={key:0,class:"disconnected-overlay"},u={key:1,class:"centered-text"},p={key:2,class:"experiment-running-overlay"},m={style:{"text-align":"right"}},h={key:4};function v(e,t,o,n,r,i){const l=(0,a.resolveComponent)("CFormSwitch"),s=(0,a.resolveComponent)("PumpControl"),c=(0,a.resolveComponent)("ValveControl"),v=(0,a.resolveComponent)("StirrerControl"),g=(0,a.resolveComponent)("ODControl");return(0,a.openBlock)(),(0,a.createElementBlock)("div",{class:(0,a.normalizeClass)(["DeviceControl",{"device-disconnected":!1===e.deviceConnected}])},[!1===e.deviceConnected?((0,a.openBlock)(),(0,a.createElementBlock)("div",d)):(0,a.createCommentVNode)("",!0),!1===e.deviceConnected?((0,a.openBlock)(),(0,a.createElementBlock)("div",u," device connection not available ")):(0,a.createCommentVNode)("",!0),!1===e.deviceControlEnabled?((0,a.openBlock)(),(0,a.createElementBlock)("div",p)):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",m,[(0,a.createVNode)(l,{label:"Calibration Mode",id:"formSwitchCheckChecked",modelValue:e.calibrationModeEnabled,"onUpdate:modelValue":t[0]||(t[0]=t=>e.calibrationModeEnabled=t),onChange:e.toggleCalibrationMode},null,8,["modelValue","onChange"])]),e.deviceControlEnabled||r.controlsVisible?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:3},[(0,a.createVNode)(s),(0,a.createVNode)(c),(0,a.createVNode)(v),(0,a.createVNode)(g)],64)):((0,a.openBlock)(),(0,a.createElementBlock)("p",h,"Device Control Disabled - please pause experiment to control device."))],2)}const g=e=>((0,a.pushScopeId)("data-v-178ee40e"),e=e(),(0,a.popScopeId)(),e),b={class:"pump-controls"},C=["onClick"],x={key:0,class:"spinner-border spinner-custom",role:"status"},k={key:1},E=g((()=>(0,a.createElementVNode)("br",null,null,-1))),w={class:"pump-input"},f={class:"form-group"},y={key:0,class:"form-group"};function V(e,t,o,n,r,i){const l=(0,a.resolveComponent)("CFormInput"),s=(0,a.resolveComponent)("PumpCalibration");return(0,a.openBlock)(),(0,a.createElementBlock)("div",b,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)([1,2,4],(t=>(0,a.createElementVNode)("div",{class:"pump",key:t},[(0,a.createElementVNode)("button",{class:(0,a.normalizeClass)(["pump-button",{"stop-button":"running"===e.pumps.states[t]}]),onClick:e=>i.handlePumpClick(t)},["running"===e.pumps.states[t]?((0,a.openBlock)(),(0,a.createElementBlock)("div",x)):((0,a.openBlock)(),(0,a.createElementBlock)("span",k,[(0,a.createTextVNode)((0,a.toDisplayString)(r.pump_names[t]),1),E,(0,a.createTextVNode)("pump")]))],10,C),(0,a.createElementVNode)("div",w,[(0,a.createElementVNode)("div",f,[(0,a.createVNode)(l,{id:"volume",placeholder:"volume (mL)",type:"number",size:"lg",value:r.volume[t],onInput:e=>i.onVolumeInput(e,t)},null,8,["value","onInput"])]),e.calibrationModeEnabled?((0,a.openBlock)(),(0,a.createElementBlock)("div",y,[(0,a.createVNode)(l,{id:"rotations",placeholder:"rotations",type:"float",size:"sm",value:r.rotations[t],onInput:e=>i.onRotationsInput(e,t)},null,8,["value","onInput"]),(0,a.createVNode)(s,{pumpId:t},null,8,["pumpId"])])):(0,a.createCommentVNode)("",!0)])]))),64))])}var N=o(28549);const B=e=>((0,a.pushScopeId)("data-v-00452574"),e=e(),(0,a.popScopeId)(),e),D={class:"pump-data"},S=B((()=>(0,a.createElementVNode)("tr",null,[(0,a.createElementVNode)("th",null,"Calibration Sequence"),(0,a.createElementVNode)("th"),(0,a.createElementVNode)("th",null,"Volume (mL)")],-1))),I={class:"iteration-rotation-wrapper"},P={class:"iteration"},_=B((()=>(0,a.createElementVNode)("div",{class:"multiplier"},"x",-1))),A={class:"rotation"},O=["onClick"],T={key:0},F={key:1},M=["onUpdate:modelValue","onChange"],L={class:"chart-container"};function $(e,t,o,n,r,i){const l=(0,a.resolveComponent)("Bar");return(0,a.openBlock)(),(0,a.createElementBlock)("div",D,[(0,a.createElementVNode)("table",null,[S,((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.rows,((e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("tr",{key:t},[(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("div",I,[(0,a.createElementVNode)("div",P,(0,a.toDisplayString)(e.iterations),1),_,(0,a.createElementVNode)("div",A,(0,a.toDisplayString)(e.rotations)+" rots",1)])]),(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("button",{onClick:e=>i.toggleButtonState(t),class:(0,a.normalizeClass)({"stop-button":r.isStopButton[t]})},[r.isStopButton[t]?((0,a.openBlock)(),(0,a.createElementBlock)("span",F,"Stop")):((0,a.openBlock)(),(0,a.createElementBlock)("span",T,"Pump"))],10,O)]),(0,a.createElementVNode)("td",null,[(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":t=>e.total_ml=t,onChange:t=>i.onTotalMlInput(e),type:"float"},null,40,M),[[a.vModelText,e.total_ml]])])])))),128))]),(0,a.createElementVNode)("div",L,[r.chartData.datasets[0].data.length>0?((0,a.openBlock)(),(0,a.createBlock)(l,{key:0,id:"pump-calibration-chart",options:r.chartOptions,class:"pump-calibration-chart",data:r.chartData},null,8,["options","data"])):(0,a.createCommentVNode)("",!0)])])}var R=o(32005),U=o(65750);U.kL.register(U.Dx,U.u,U.ZL,U.uw,U.f$);var j={components:{Bar:R.$Q},data(){return{chartData:{datasets:[{data:[]}]},chartOptions:{responsive:!0,devicePixelRatio:4,maintainAspectRatio:!1,plugins:{legend:{display:!1}},backgroundColor:"rgba(0, 140, 186, 0.3)",layout:{padding:{top:20}},scales:{x:{title:{display:!0,text:"rotations"}},y:{title:{display:!0,text:"mL / rotation"},beginAtZero:!1,suggestedMin:.1,suggestedMax:.22}}},isStopButton:{},rows:[{rotations:1,iterations:50,total_ml:NaN},{rotations:5,iterations:10,total_ml:NaN},{rotations:10,iterations:5,total_ml:NaN},{rotations:50,iterations:1,total_ml:NaN}]}},props:{pumpId:{type:Number,required:!0}},computed:{...(0,c.rn)("device",["calibrationModeEnabled","pumps","valves"]),pumpIdCalibrationData(){return this.pumps?.calibration[this.pumpId]}},methods:{...(0,c.nv)("device",["setPartCalibrationAction","startPumpCalibrationSequence","setPartStateAction"]),createChartData(){return{labels:Object.keys(this.pumpIdCalibrationData),datasets:[{label:null,data:Object.values(this.pumpIdCalibrationData),fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}},updateChartData(){this.chartData=this.createChartData()},toggleButtonState(e){const t=Object.values(this.valves.states).some((e=>"open"===e));t?(this.$set(this.isStopButton,e,!this.isStopButton[e]),this.isStopButton[e]?this.promptForMl(this.rows[e]):this.setPartStateAction({devicePart:"pumps",partIndex:this.pumpId,newState:"stopped"})):alert("At least one valve must be open to start the pump")},resetButton(e){this.$set(this.isStopButton,e,!1)},onTotalMlInput(e){e.total_ml&&(this.pumps.calibration[this.pumpId][e.rotations]=e.total_ml/e.rotations/e.iterations,this.setPartCalibrationAction({devicePart:"pumps",partIndex:this.pumpId,newCalibration:this.pumps.calibration[this.pumpId]}))},promptForMl(e){console.log("starting pump calibration sequence for pumpId: "+this.pumpId),alert("Pumping "+e.rotations+" rotations "+e.iterations+" times. Please blank the scale"),this.startPumpCalibrationSequence({pumpId:this.pumpId,rotations:e.rotations,iterations:e.iterations}).then((()=>{console.log("pump calibration sequence finished"),this.resetButton(e);const t=parseFloat(prompt("Enter total mL pumped"));isNaN(t)||(e.total_ml=t,this.onTotalMlInput(e))}))}},mounted(){this.pumpIdCalibrationData&&this.updateChartData(),this.rows.forEach((e=>{e.total_ml=this.pumps.calibration[this.pumpId][e.rotations]*e.rotations*e.iterations,e.total_ml=e.total_ml.toFixed(2)}))},watch:{pumpIdCalibrationData:{deep:!0,handler(){this.updateChartData()}}}},Z=o(83744);const q=(0,Z.Z)(j,[["render",$],["__scopeId","data-v-00452574"]]);var z=q,H={components:{PumpCalibration:z,CFormInput:N.jO},name:"PumpControl",data(){return{pump_names:{1:"MAIN",2:"DRUG",3:"MISSING!!!",4:"WASTE"},rotations:{1:null,2:null,3:null,4:null},volume:{1:null,2:null,3:null,4:null}}},computed:{...(0,c.rn)("device",["pumps","valves","calibrationModeEnabled"])},methods:{...(0,c.nv)("device",["setPartStateAction"]),async handlePumpClick(e){if("running"===this.pumps.states[e])return void await this.setPartStateAction({devicePart:"pumps",partIndex:e,newState:"stopped"});console.log("handlePumpClick, pumpId: "+e);const t=Object.values(this.valves.states).some((e=>"open"===e));if(!t)return void alert("At least one valve must be open to start the pump");const o=parseFloat(this.volume[e]);if(console.log("volume: "+o),o)try{await this.setPartStateAction({devicePart:"pumps",partIndex:e,newState:"running",input:{volume:o}})}catch(a){console.error(a)}finally{await this.setPartStateAction({devicePart:"pumps",partIndex:e,newState:"stopped"})}else alert("Please set the volume before starting the pump")},onVolumeInput(e,t){this.volume[t]=e.target.value;const o=parseFloat(this.volume[t]);isNaN(o)?this.rotations[t]="":this.rotations[t]=this.calculateRotations(o,t).toFixed(2)},onRotationsInput(e,t){this.rotations[t]=e.target.value;const o=parseFloat(this.rotations[t]);isNaN(o)?this.volume[t]="":this.volume[t]=this.calculateVolume(o,t)},calculateRotations(e,t){const o=this.pumps.calibration[t],a=Object.entries(o).map((([e,t])=>[parseInt(e),t])).sort(((e,t)=>e[0]-t[0]));if(e>=a[a.length-1][0]*a[a.length-1][1])return e/a[a.length-1][1];let n=a[0],r=a[a.length-1];for(let u=0;u<a.length-1;u++)if(e>=a[u][0]*a[u][1]&&e<=a[u+1][0]*a[u+1][1]){n=a[u],r=a[u+1];break}const i=n[0]*n[1],l=r[0]*r[1],s=(e-i)/(l-i),c=n[1]+(r[1]-n[1])*s,d=e/c;return d},calculateVolume(e,t){const o=this.pumps.calibration[t],a=Object.entries(o).map((([e,t])=>[parseInt(e),t])).sort(((e,t)=>e[0]-t[0]));if(e>=a[a.length-1][0])return(e*a[a.length-1][1]).toFixed(2);let n=a[0],r=a[a.length-1];for(let c=0;c<a.length-1;c++)if(e>=a[c][0]&&e<=a[c+1][0]){n=a[c],r=a[c+1];break}const i=(e-n[0])/(r[0]-n[0]),l=n[1]+(r[1]-n[1])*i,s=e*l;return s.toFixed(2)}}};const X=(0,Z.Z)(H,[["render",V],["__scopeId","data-v-178ee40e"]]);var Y=X;const G={class:"valve-controls"},K=["onClick","disabled"],W={key:0,class:"spinner-border spinner-custom",role:"status"},J={key:1};function Q(e,t,o,n,r,i){return(0,a.openBlock)(),(0,a.createElementBlock)("div",G,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(7,(t=>(0,a.createElementVNode)("button",{class:(0,a.normalizeClass)(["btn",{"btn-danger":"closed"===e.valves.states[t]&&!r.togglingValves[t],"btn-success":"open"===e.valves.states[t]&&!r.togglingValves[t],"btn-warning":r.togglingValves[t]}]),key:t,onClick:e=>i.toggleValve(t),disabled:r.togglingValves[t]},[r.togglingValves[t]?((0,a.openBlock)(),(0,a.createElementBlock)("div",W)):((0,a.openBlock)(),(0,a.createElementBlock)("span",J,"Valve "+(0,a.toDisplayString)(t),1))],10,K))),64))])}var ee={name:"ValveControl",computed:(0,c.rn)("device",["valves"]),data(){return{audioContext:new(window.AudioContext||window.webkitAudioContext),togglingValves:{}}},methods:{...(0,c.nv)("device",["setPartStateAction"]),toggleValve(e){const t=this.valves.states[e];if(this.togglingValves[e])return;this.togglingValves={...this.togglingValves,[e]:!0};const o=this.playValveSound(t);this.setPartStateAction({devicePart:"valves",partIndex:e,newState:"open"===t?"closed":"open"}).then((()=>{o.stop(),this.togglingValves={...this.togglingValves,[e]:!1}})).catch((e=>{console.error(e)}))},playValveSound(e){const t="open"===e?500:300,o="open"===e?300:500,a=this.audioContext.createOscillator();a.type="sine";const n=this.audioContext.createGain();return n.gain.setValueAtTime(.1,this.audioContext.currentTime),a.connect(n),n.connect(this.audioContext.destination),a.frequency.setValueAtTime(t,this.audioContext.currentTime),a.frequency.linearRampToValueAtTime(o,this.audioContext.currentTime+.3),a.start(),a.stop(this.audioContext.currentTime+.3),a}}};const te=(0,Z.Z)(ee,[["render",Q],["__scopeId","data-v-f781ac02"]]);var oe=te;const ae={class:"stirrer-controls"};function ne(e,t,o,n,r,i){const l=(0,a.resolveComponent)("StirrerCalibration");return(0,a.openBlock)(),(0,a.createElementBlock)("div",ae,[((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(7,(e=>(0,a.createVNode)(l,{key:e,stirrerId:e},null,8,["stirrerId"]))),64))])}const re={class:"stirrer-calibrator",ref:"container"},ie={class:"elements-container"},le={class:"stirrer-name"},se={key:0},ce=["min","max"],de=["min","max"],ue={class:"svg-container"},pe=["x1","y1","x2","y2"],me=["x1","y1","x2","y2"],he={class:"buttons-container"};function ve(e,t,o,n,r,i){return(0,a.openBlock)(),(0,a.createElementBlock)("div",re,[(0,a.createElementVNode)("div",ie,[(0,a.createElementVNode)("div",le,[(0,a.createElementVNode)("header",null,"Stirrer "+(0,a.toDisplayString)(o.stirrerId),1)]),e.calibrationModeEnabled?((0,a.openBlock)(),(0,a.createElementBlock)("div",se,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"range",class:(0,a.normalizeClass)(["slider slider-high",{active:"high"===i.currentStirrerState}]),min:r.min,max:r.max,step:.01,"onUpdate:modelValue":t[0]||(t[0]=t=>e.stirrers.calibration[o.stirrerId].high=t),onChange:t[1]||(t[1]=e=>i.onSliderChange("high",e)),onInput:t[2]||(t[2]=e=>i.onSliderInput("high",e))},null,42,ce),[[a.vModelText,e.stirrers.calibration[o.stirrerId].high]]),(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"range",class:(0,a.normalizeClass)(["slider slider-low",{active:"low"===i.currentStirrerState}]),min:r.min,max:r.max,step:.01,"onUpdate:modelValue":t[3]||(t[3]=t=>e.stirrers.calibration[o.stirrerId].low=t),onChange:t[4]||(t[4]=e=>i.onSliderChange("low",e)),onInput:t[5]||(t[5]=e=>i.onSliderInput("low",e))},null,42,de),[[a.vModelText,e.stirrers.calibration[o.stirrerId].low]]),((0,a.openBlock)(),(0,a.createElementBlock)("svg",ue,[(0,a.createElementVNode)("line",{x1:r.lowX1,y1:r.lowY1,x2:r.lowX2,y2:r.lowY2,stroke:"gray","stroke-width":"1"},null,8,pe),(0,a.createElementVNode)("line",{x1:r.highX1,y1:r.highY1,x2:r.highX2,y2:r.highY2,stroke:"gray","stroke-width":"1"},null,8,me)]))])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",he,[(0,a.createElementVNode)("button",{class:(0,a.normalizeClass)(["button button-high",{active:"high"===i.currentStirrerState}]),ref:"buttonHigh",onClick:t[6]||(t[6]=e=>i.onClick("high")),onDblclick:t[7]||(t[7]=e=>i.onDoubleClick("high"))}," High ",34),(0,a.createElementVNode)("button",{class:(0,a.normalizeClass)(["button button-low",{active:"low"===i.currentStirrerState}]),ref:"buttonLow",onClick:t[8]||(t[8]=e=>i.onClick("low")),onDblclick:t[9]||(t[9]=e=>i.onDoubleClick("low"))}," Low ",34),(0,a.createElementVNode)("button",{class:(0,a.normalizeClass)(["button button-off",{active:"stopped"===i.currentStirrerState}]),ref:"buttonOff",onClick:t[10]||(t[10]=e=>i.onClick("stopped")),onDblclick:t[11]||(t[11]=e=>i.onDoubleClick("stopped"))}," OFF ",34)])])],512)}var ge={name:"StirrerCalibration",props:{stirrerId:{type:Number,required:!0}},watch:{calibrationModeEnabled(e){e&&this.$nextTick(this.updateLine)}},data(){return{min:0,max:1,lowX1:0,lowY1:0,lowX2:0,lowY2:0,highX1:0,highY1:0,highX2:0,highY2:0,audioContext:new(window.AudioContext||window.webkitAudioContext),oscillator:null,gainNode:null,stopSoundTimeout:null}},computed:{...(0,c.rn)("device",["calibrationModeEnabled","stirrers"]),currentStirrerState(){return this.stirrers.states[this.stirrerId]}},methods:{...(0,c.nv)("device",["setPartStateAction","setPartCalibrationAction","getAllDeviceData","setAllStirrersStateAction"]),onClick(e){this.setPartStateAction({devicePart:"stirrers",partIndex:this.stirrerId,newState:e})},onDoubleClick(e){this.setAllStirrersStateAction(e)},onSliderChange(e,t){"low"===e?this.stirrers.calibration[this.stirrerId].low=parseFloat(t.target.value):"high"===e&&(this.stirrers.calibration[this.stirrerId].high=parseFloat(t.target.value)),this.setPartCalibrationAction({devicePart:"stirrers",partIndex:this.stirrerId,newCalibration:{low:this.stirrers.calibration[this.stirrerId].low,high:this.stirrers.calibration[this.stirrerId].high}}).catch((e=>{console.error("Error updating stirrer calibration:",e)}))},onSliderInput(e,t){"low"===e?this.stirrers.calibration[this.stirrerId].low=parseFloat(t.target.value):"high"===e&&(this.stirrers.calibration[this.stirrerId].high=parseFloat(t.target.value)),this.updateLine(),this.playSound(t.target.value)},updateLine(){this.$nextTick((()=>{const e=this.$refs.container,t=e.getBoundingClientRect(),o=this.$el.querySelector(".slider-low"),a=this.$refs.buttonLow,n=o.getBoundingClientRect(),r=a.getBoundingClientRect();this.lowX1=n.x-t.x+n.width/2,this.lowY1=n.y-t.y+n.height*(1-this.stirrers.calibration[this.stirrerId].low/(this.max-this.min)),this.lowX2=r.x-t.x,this.lowY2=r.y-t.y+r.height/2;const i=this.$el.querySelector(".slider-high"),l=this.$refs.buttonHigh,s=i.getBoundingClientRect(),c=l.getBoundingClientRect();this.highX1=s.x-t.x+s.width/2,this.highY1=s.y-t.y+s.height*(1-this.stirrers.calibration[this.stirrerId].high/(this.max-this.min)),this.highX2=c.x-t.x,this.highY2=c.y-t.y+c.height/2}))},playSound(e){this.oscillator||(this.oscillator=this.audioContext.createOscillator(),this.gainNode=this.audioContext.createGain(),this.oscillator.type="sine",this.gainNode.gain.setValueAtTime(.1,this.audioContext.currentTime),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),this.oscillator.start());const t=300+500*e;this.oscillator.frequency.setValueAtTime(t,this.audioContext.currentTime),this.stopSoundTimeout&&clearTimeout(this.stopSoundTimeout),this.stopSoundTimeout=setTimeout(this.stopSound,200)},stopSound(){this.oscillator&&(this.gainNode.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.01),this.gainNode.gain.setValueAtTime(.1,this.audioContext.currentTime+.02),this.oscillator.stop(this.audioContext.currentTime+.02),this.oscillator=null,this.gainNode=null)}}};const be=(0,Z.Z)(ge,[["render",ve],["__scopeId","data-v-d360c050"]]);var Ce=be,xe={name:"StirrerControl",components:{StirrerCalibration:Ce}};const ke=(0,Z.Z)(xe,[["render",ne],["__scopeId","data-v-4030e64e"]]);var Ee=ke;const we=e=>((0,a.pushScopeId)("data-v-0dc56327"),e=e(),(0,a.popScopeId)(),e),fe={class:"od-control-container"},ye=["onClick"],Ve={key:0,class:"od-output-value"},Ne=we((()=>(0,a.createElementVNode)("div",{style:{height:"0.5px"}},null,-1))),Be={key:1,class:"signal-output-value"},De={key:0},Se=we((()=>(0,a.createElementVNode)("th",null,"OD value",-1))),Ie=we((()=>(0,a.createElementVNode)("th",null,null,-1))),Pe=we((()=>(0,a.createElementVNode)("th",null,null,-1))),_e=["value","onChange"],Ae=["onClick"],Oe=["onChange","onUpdate:modelValue"],Te=["disabled","onClick"],Fe={class:"chart-container"};function Me(e,t,o,n,r,i){const l=(0,a.resolveComponent)("ODChart");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[(0,a.createElementVNode)("div",fe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.ods.states,((t,o)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{class:"elements-container",key:o},[(0,a.createElementVNode)("button",{class:"od-button",onClick:e=>i.handleOdClick(o)},[(0,a.createElementVNode)("span",null,"OD "+(0,a.toDisplayString)(o),1)],8,ye),e.ods.states&&void 0!==e.ods.states[o]?((0,a.openBlock)(),(0,a.createElementBlock)("span",Ve,(0,a.toDisplayString)(parseFloat(e.ods.states[o].toFixed(2))),1)):(0,a.createCommentVNode)("",!0),Ne,e.ods.odsignals&&void 0!==e.ods.odsignals[o]?((0,a.openBlock)(),(0,a.createElementBlock)("span",Be,"("+(0,a.toDisplayString)(parseFloat(e.ods.odsignals[o].toFixed(2)))+"mV)",1)):(0,a.createCommentVNode)("",!0)])))),128))]),e.calibrationModeEnabled?((0,a.openBlock)(),(0,a.createElementBlock)("div",De,[(0,a.createElementVNode)("table",null,[(0,a.createElementVNode)("thead",null,[(0,a.createElementVNode)("tr",null,[Se,Ie,((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.vials,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("th",{key:e},(0,a.toDisplayString)("vial "+e),1)))),128)),Pe])]),(0,a.createElementVNode)("tbody",null,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(i.allOdValues,(t=>((0,a.openBlock)(),(0,a.createElementBlock)("tr",{key:t},[(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("input",{value:t,onChange:o=>e.updateODCalibrationKeyAction({oldOD:t,newOD:o.target.value}),type:"number",step:"0.1"},null,40,_e)]),(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("button",{onClick:o=>e.measureODCalibrationAction({odValue:t})},"Measure",8,Ae)]),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.vials,(o=>((0,a.openBlock)(),(0,a.createElementBlock)("td",{key:o},[(0,a.withDirectives)((0,a.createElementVNode)("input",{class:"calibration-signal",onChange:a=>e.updateODCalibrationValueAction({od:t,odsIndex:o,newValue:a.target.value}),"onUpdate:modelValue":a=>e.ods.calibration[o][t]=a,type:"number",style:{opacity:"60%"}},null,40,Oe),[[a.vModelText,e.ods.calibration[o][t]]])])))),128)),(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("button",{class:"button button-delete",disabled:r.isLoading,onClick:e=>i.handleDeleteRowClick(t)},"Delete Row",8,Te)])])))),128)),(0,a.createElementVNode)("tr",null,[(0,a.createElementVNode)("td",null,[(0,a.withDirectives)((0,a.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.newRowValue=e),type:"number",step:"0.1"},null,512),[[a.vModelText,r.newRowValue]])]),(0,a.createElementVNode)("td",null,[(0,a.createElementVNode)("button",{class:"button button-new",onClick:t[1]||(t[1]=t=>e.measureODCalibrationAction({odValue:r.newRowValue}))},"Measure new probe")])])])]),(0,a.createElementVNode)("div",Fe,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.vials,(e=>((0,a.openBlock)(),(0,a.createBlock)(l,{partId:e,key:e},null,8,["partId"])))),128))])])):(0,a.createCommentVNode)("",!0)],64)}const Le={className:"single-chart-container"};function $e(e,t,o,n,r,i){const l=(0,a.resolveComponent)("Scatter");return(0,a.openBlock)(),(0,a.createElementBlock)("div",Le,[(0,a.createVNode)(l,{data:i.chartData,options:i.chartOptions},null,8,["data","options"])])}o(57658);function Re(e,t,o,a,n,r){return n+(t-n)/Math.pow(1+Math.pow(e/a,o),r)}U.kL.register(U.Dx,U.u,U.De,U.jn,U.uw,U.f$,U.od);var Ue={name:"LineChart",components:{Scatter:R.bp},props:{partId:{type:Number,required:!0}},computed:{...(0,c.rn)("device",["ods","calibrationModeEnabled"]),calibrationData(){return this.ods?.calibration[this.partId]},calibrationCoefs(){return this.ods?.calibration_coefs[this.partId]},currentOD(){return{od:this.ods?.states[this.partId],signal:this.ods?.odsignals[this.partId]}},chartData(){if(this.calibrationData&&"object"===typeof this.calibrationData&&this.calibrationCoefs){const e=Object.entries(this.calibrationData).map((([e,t])=>({x:Number(t),y:Number(e)}))).sort(((e,t)=>e.x-t.x)),t=Math.min(...e.map((e=>e.x))),o=Math.max(...e.map((e=>e.x))),a=[];for(let n=t;n<=o;n+=.1){const e=Re(n,...this.calibrationCoefs);a.push({x:n,y:e})}return{datasets:[{label:`Vial ${this.partId} Calibration OD`,data:e,borderColor:"#607ecb",backgroundColor:"rgba(83,158,255,0.64)"},{label:`Vial ${this.partId} Current OD`,data:[{x:this.currentOD.signal,y:this.currentOD.od}],pointRadius:5,backgroundColor:"rgba(255,1,60,0.64)"},{label:`Vial ${this.partId} Fit`,data:a,pointRadius:0,borderColor:"rgba(0,70,220,0.38)",borderWidth:2,showLine:!0,fill:!1,borderDash:[2,2]}]}}return{}},chartOptions(){return{devicePixelRatio:4,responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Vial ${this.partId}`}},scales:{x:{title:{display:!0,text:"Signal (mV)"},suggestedMin:0},y:{title:{display:!0,text:"OD"},suggestedMax:1.5,suggestedMin:0}}}}}};const je=(0,Z.Z)(Ue,[["render",$e]]);var Ze=je,qe={components:{ODChart:Ze},data(){return{vials:[1,2,3,4,5,6,7],newRowValue:null,isLoading:!1}},computed:{...(0,c.rn)("device",["ods","calibrationModeEnabled"]),allOdValues(){let e=new Set;for(let t in this.ods.calibration)for(let o in this.ods.calibration[t])e.add(o);return Array.from(e)}},methods:{...(0,c.nv)("device",["getAllDeviceData","setPartStateAction","measureDevicePart","measureODCalibrationAction","setPartCalibrationAction","removeODCalibrationRowAction","updateODCalibrationKeyAction","updateODCalibrationValueAction"]),async handleOdClick(e){await this.measureDevicePart({devicePart:"ods",partIndex:e}).then((()=>{this.getAllDeviceData()}))},async handleDeleteRowClick(e){this.isLoading=!0;try{await this.removeODCalibrationRowAction(e)}catch(t){console.log(t)}finally{this.isLoading=!1}}}};const ze=(0,Z.Z)(qe,[["render",Me],["__scopeId","data-v-0dc56327"]]);var He=ze,Xe={components:{PumpControl:Y,ValveControl:oe,StirrerControl:Ee,ODControl:He,CFormSwitch:N.kV},computed:{...(0,c.rn)(["deviceConnected","deviceControlEnabled"]),...(0,c.rn)("device",["calibrationModeEnabled","stirrers","pumps","valves","ods"])},data(){return{controlsVisible:!1}},watch:{deviceControlEnabled(e){this.controlsVisible=!!e}},mounted(){this.deviceConnected||this.connectDevice().then((()=>{this.getAllDeviceData().then((()=>{}))}))},methods:{...(0,c.OI)("device",["toggleCalibrationMode","setDeviceControlEnabled"]),...(0,c.nv)("device",["getAllDeviceData"]),...(0,c.nv)(["connectDevice"])}};const Ye=(0,Z.Z)(Xe,[["render",v],["__scopeId","data-v-c8fa8dd4"]]);var Ge=Ye;function Ke(e,t,o,n,r,i){const l=(0,a.resolveComponent)("ExperimentSetup"),s=(0,a.resolveComponent)("ExperimentChart");return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.createVNode)(l),Object.keys(e.currentExperiment?.parameters?.cultures||{}).length>0?((0,a.openBlock)(),(0,a.createBlock)(s,{key:0})):(0,a.createCommentVNode)("",!0)])}const We={class:"experiment-setup"},Je={class:"d-flex"},Qe=["value"],et={key:0,class:"d-flex"},tt={key:1},ot={class:"button-container"},at={class:"experiment-parameters",style:{"align-items":"center",display:"flex","flex-direction":"column","margin-top":"20px"}},nt={key:0,class:"experiment-cultures"};function rt(e,t,o,n,r,i){const l=(0,a.resolveComponent)("CToastHeader"),s=(0,a.resolveComponent)("CToastBody"),c=(0,a.resolveComponent)("CToast"),d=(0,a.resolveComponent)("CFormSelect"),u=(0,a.resolveComponent)("CFormFloating"),p=(0,a.resolveComponent)("CButton"),m=(0,a.resolveComponent)("CFormInput"),h=(0,a.resolveComponent)("CultureConfig"),v=(0,a.resolveComponent)("CCol"),g=(0,a.resolveComponent)("CRow");return(0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,null,[e.errorMessage?((0,a.openBlock)(),(0,a.createBlock)(c,{key:0,autohide:!0,fade:!0,onHidden:e.clearErrorMessage},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(l,{closeButton:""},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Error ")]),void 0,!0),_:1}),(0,a.createVNode)(s,null,{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(e.errorMessage),1)]),void 0,!0),_:1})]),void 0,!0),_:1},8,["onHidden"])):(0,a.createCommentVNode)("",!0),(0,a.createElementVNode)("div",We,[(0,a.createElementVNode)("div",Je,[(0,a.createVNode)(u,{class:"flex-grow-1"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(d,{modelValue:r.currentExperimentId,"onUpdate:modelValue":t[0]||(t[0]=e=>r.currentExperimentId=e),id:"floatingSelect",floatingLabel:"Select Experiment","aria-label":"Floating label select example",onChange:i.handleExperimentSelected},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(i.reversedExperiments,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("option",{key:e.id,value:e.id},(0,a.toDisplayString)(e.name),9,Qe)))),128))]),void 0,!0),_:1},8,["modelValue","onChange"])]),void 0,!0),_:1}),(0,a.createVNode)(p,{color:"primary",onClick:i.handleNewExperimentButton,class:"ml-3"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("+")]),void 0,!0),_:1},8,["onClick"])]),r.showCreate?((0,a.openBlock)(),(0,a.createElementBlock)("div",et,[r.showCreate?((0,a.openBlock)(),(0,a.createBlock)(u,{key:0,class:"flex-grow-1"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(m,{"model-value":r.newExperimentname,"onUpdate:modelValue":t[1]||(t[1]=e=>r.newExperimentname=e),id:"floatingInput",floatingLabel:"New Experiment Name"},null,8,["model-value"])]),void 0,!0),_:1})):(0,a.createCommentVNode)("",!0),(0,a.createVNode)(p,{color:"success",onClick:i.createAndSelectExperiment,class:"ml-3"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)("Create Experiment")]),void 0,!0),_:1},8,["onClick"])])):(0,a.createCommentVNode)("",!0),e.currentExperiment?((0,a.openBlock)(),(0,a.createElementBlock)("div",tt,[(0,a.createElementVNode)("div",ot,[(0,a.createVNode)(p,{class:(0,a.normalizeClass)({active:"running"===e.currentExperiment.status}),style:(0,a.normalizeStyle)({"background-color":"running"===e.currentExperiment.status?"#28a745":"transparent"}),onClick:t[2]||(t[2]=t=>e.startExperiment(e.currentExperiment.id)),color:"success"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Start ")]),void 0,!0),_:1},8,["class","style"]),(0,a.createVNode)(p,{class:(0,a.normalizeClass)({active:"paused"===e.currentExperiment.status}),style:(0,a.normalizeStyle)({"background-color":"paused"===e.currentExperiment.status?"#ffc107":"transparent"}),onClick:t[3]||(t[3]=t=>e.pauseExperiment(e.currentExperiment.id)),color:"warning"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Pause ")]),void 0,!0),_:1},8,["class","style"]),(0,a.createVNode)(p,{class:(0,a.normalizeClass)({active:"stopped"===e.currentExperiment.status}),style:(0,a.normalizeStyle)({"background-color":"stopped"===e.currentExperiment.status?"#dc3545":"transparent"}),onClick:t[4]||(t[4]=t=>e.stopExperiment(e.currentExperiment.id)),color:"danger"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)(" Stop ")]),void 0,!0),_:1},8,["class","style"])]),(0,a.createElementVNode)("div",at,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.currentExperiment.parameters,((t,o)=>((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:o},["cultures"!==o?((0,a.openBlock)(),(0,a.createBlock)(u,{key:0,class:"flex-grow-1"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(m,{"model-value":t,"onUpdate:modelValue":t=>e.currentExperiment.parameters[o]=t,id:`floatingInput_${o}`,"floating-label":`${o}`,placeholder:`Enter ${o}`},null,8,["model-value","onUpdate:modelValue","id","floating-label","placeholder"])]),void 0,!0),_:2},1024)):(0,a.createCommentVNode)("",!0)],64)))),128)),Object.keys(e.currentExperiment?.parameters?.cultures||{}).length>0?((0,a.openBlock)(),(0,a.createElementBlock)("div",nt,[(0,a.createVNode)(g,{class:"culture-row"},{default:(0,a.withCtx)((()=>[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(e.currentExperiment.parameters.cultures,((t,o)=>((0,a.openBlock)(),(0,a.createBlock)(v,{key:o,class:"culture-column"},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(h,{experiment:e.currentExperiment,vial:o},null,8,["experiment","vial"])]),void 0,!0),_:2},1024)))),128))]),void 0,!0),_:1})])):(0,a.createCommentVNode)("",!0)])])):(0,a.createCommentVNode)("",!0)])],64)}const it=e=>((0,a.pushScopeId)("data-v-49dd09da"),e=e(),(0,a.popScopeId)(),e),lt={class:"culture-config"},st=it((()=>(0,a.createElementVNode)("br",null,null,-1))),ct=["innerHTML"];function dt(e,t,o,n,r,i){const l=(0,a.resolveComponent)("b-tooltip"),s=(0,a.resolveComponent)("CFormInput"),c=(0,a.resolveDirective)("b-tooltip");return(0,a.openBlock)(),(0,a.createElementBlock)("div",lt,[(0,a.createElementVNode)("h6",null,"Culture "+(0,a.toDisplayString)(o.vial),1),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(o.experiment.parameters.cultures[o.vial],((e,t)=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{key:t},[(0,a.withDirectives)(((0,a.openBlock)(),(0,a.createBlock)(s,{value:e,placeholder:t,id:`floatingInput_${t}_vial_${o.vial}`,"floating-label":`${t}`,onChange:e=>i.handleInputChange(t,e.target.value),title:`Tooltip for ${t}`},{default:(0,a.withCtx)((()=>[(0,a.createVNode)(l,{target:`floatingInput_${t}_vial_${o.vial}`,triggers:"hover",placement:"left",delay:"500"},{default:(0,a.withCtx)((()=>[(0,a.createTextVNode)((0,a.toDisplayString)(t)+":",1),st,(0,a.createTextVNode)(),(0,a.createElementVNode)("span",{innerHTML:r.tooltips[t]},null,8,ct)]),void 0,!0),_:2},1032,["target"])]),void 0,!0),_:2},1032,["value","placeholder","id","floating-label","onChange","title"])),[[c,void 0,void 0,{hover:!0}]])])))),128))])}var ut=o(18365),pt={data(){return{tooltips:{name:"The name of the culture. For example, <i>Escherichia coli</i> or <i>Saccharomyces cerevisiae</i>.",description:"A description of the culture. For example, <i>MG1655</i> or <i>BY4741</i>.",volume_fixed:"The fixed volume of the culture in milliliters (mL).",volume_added:"The total media volume added to the culture at a dilution step in milliliters (mL).",od_threshold:"The optical density (OD) threshold for the culture to be diluted.",od_threshold_first_dilution:"The optical density (OD) threshold for the culture to be diluted for the first time.",stress_dose_first_dilution:"The resulting stress dose after the first dilution.",stress_increase_delay_generations:"The number of generations to wait before increasing the stress dose.",stress_increase_tdoubling_min_hrs:"The minimum culture doubling time in hours (hrs) for an increase in stress dose to be allowed.",stress_decrease_delay_hrs:"How long to wait before decreasing the stress dose if the culture does not reach the <i>od_threshold</i>.",stress_decrease_tdoubling_max_hrs:"The maximum culture doubling time in hours (hrs) for a decrease in stress dose to be allowed. If the doubling time is lower than this value, the culture is considered healthy and the stress dose will not be decreased."}}},components:{CFormInput:N.jO,BTooltip:ut.T},props:{experiment:{type:Object,required:!0},vial:{type:Number,required:!0}},methods:{...(0,c.nv)("experiment",["updateExperimentParameters"]),async handleInputChange(e,t){await this.updateExperimentParameters({experimentId:this.experiment.id,parameters:{...this.experiment.parameters,cultures:{...this.experiment.parameters.cultures,[this.vial]:{...this.experiment.parameters.cultures[this.vial],[e]:t}}}})}}};const mt=(0,Z.Z)(pt,[["render",dt],["__scopeId","data-v-49dd09da"]]);var ht=mt,vt={components:{CultureConfig:ht,CButton:N.u5,CFormFloating:N.j3,CFormInput:N.jO,CFormSelect:N.LX,CRow:N.rb,CCol:N.b7,CToast:N.oo,CToastBody:N.S3,CToastHeader:N.xZ},data(){return{newExperimentname:null,showCreate:!1,currentExperimentId:null}},computed:{...(0,c.rn)("experiment",["experiments","currentExperiment","errorMessage"]),reversedExperiments(){return[...this.experiments].reverse()}},methods:{...(0,c.nv)("experiment",["setCurrentExperimentAction","createExperiment","fetchExperiments","fetchCurrentExperiment","startExperiment","pauseExperiment","stopExperiment"]),async handleNewExperimentButton(){this.showCreate=!this.showCreate,"running"!==this.currentExperiment.status&&"paused"!==this.currentExperiment.status||await this.stopExperiment(this.currentExperiment.id)},async handleExperimentSelected(e){"running"!==this.currentExperiment.status&&"paused"!==this.currentExperiment.status||await this.stopExperiment(this.currentExperiment.id);const t=e.target.value;t!==this.currentExperimentId&&(this.currentExperimentId=t,await this.setCurrentExperimentAction(this.currentExperimentId))},async createAndSelectExperiment(){this.currentExperiment?(this.currentExperimentId=await this.createExperiment({name:this.newExperimentname,parameters:this.currentExperiment.parameters}),console.log("created new experiment with same parameters as current experiment")):(console.log("created new experiment with default parameters"),this.currentExperimentId=await this.createExperiment({name:this.newExperimentname})),console.log(this.currentExperimentId),await this.handleExperimentSelected({target:{value:this.currentExperimentId}}),this.showCreate=!1,this.newExperimentname=""}},async created(){await this.fetchExperiments(),await this.fetchCurrentExperiment(),this.currentExperimentId=this.currentExperiment.id}};const gt=(0,Z.Z)(vt,[["render",rt],["__scopeId","data-v-c8d96c60"]]);var bt=gt;const Ct={id:"CulturePlot"},xt=["id"];function kt(e,t,o,n,r,i){return(0,a.openBlock)(),(0,a.createElementBlock)("div",Ct,[(0,a.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>i.plotAllData&&i.plotAllData(...e))},"Plot"),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(r.vials,(e=>((0,a.openBlock)(),(0,a.createElementBlock)("div",{class:"graph-container",key:e,id:`vial-${e}`},null,8,xt)))),128))])}var Et=o(55332),wt=o.n(Et),ft={name:"ExperimentChart",computed:{...(0,c.rn)("experiment",["plot_data","currentExperiment"])},data(){return{vials:Array.from({length:7},((e,t)=>t+1))}},methods:{...(0,c.nv)("experiment",["fetchCulturePlot"]),async plotAllData(){if(this.currentExperiment)for(let e of this.vials)console.log(this.currentExperiment,"currentExperiment"),await this.fetchCulturePlot(e),this.plotData(e)},plotData(e){const t=this.plot_data[e]||[],o={title:`Culture ${e}`,xaxis:{title:"Time"},yaxis:{title:"Optical Density",automargin:!0,mode:"lines+markers"},yaxis2:{title:"Generation",overlaying:"y",side:"right",automargin:!0},yaxis3:{title:"Concentration",overlaying:"y",side:"right",position:.92,automargin:!0},yaxis4:{title:"Growth Rate",overlaying:"y",side:"left",position:.08,automargin:!0}},a=document.getElementById(`vial-${e}`);a&&wt().react(`vial-${e}`,t,o)}},mounted(){this.plotAllData()}};const yt=(0,Z.Z)(ft,[["render",kt],["__scopeId","data-v-28f2119b"]]);var Vt=yt,Nt={components:{ExperimentSetup:bt,ExperimentChart:Vt},computed:{...(0,c.rn)("experiment",["experiments","currentExperiment","errorMessage"])}};const Bt=(0,Z.Z)(Nt,[["render",Ke]]);var Dt=Bt;const St=(0,a.createElementVNode)("a",{style:{"margin-left":"30px"},href:"https://dashboard.ngrok.com/get-started/your-authtoken",target:"_blank"},"Get ngrok authtoken",-1),It=(0,a.createElementVNode)("br",null,null,-1),Pt=(0,a.createElementVNode)("br",null,null,-1),_t=["href"];function At(e,t,o,n,r,i){return(0,a.openBlock)(),(0,a.createElementBlock)("div",null,[(0,a.withDirectives)((0,a.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>r.authtoken=e),placeholder:"ngrok authtoken"},null,512),[[a.vModelText,r.authtoken]]),(0,a.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>i.sendAuthtoken&&i.sendAuthtoken(...e))},"Connect"),St,It,Pt,(0,a.createElementVNode)("p",null,[(0,a.createTextVNode)("Ngrok URL: "),(0,a.createElementVNode)("a",{href:r.ngrokUrl,target:"_blank"},(0,a.toDisplayString)(r.ngrokUrl),9,_t)])])}var Ot=o(6154);const Tt=Ot.Z.create({baseURL:window.location.origin+"/tunnels",timeout:15e3});console.log("Created ngrokAxios with baseURL: "+window.location.origin+"/tunnels");var Ft={data(){return{authtoken:"",ngrokUrl:""}},created(){Tt.get("/get-ngrok-url").then((e=>{console.log(e),this.ngrokUrl=e.data.ngrokUrl})).catch((e=>{console.log(e)}))},methods:{sendAuthtoken(){Tt.post("/set-ngrok-authtoken",{authtoken:this.authtoken}).then((e=>{console.log(e),this.ngrokUrl=e.data.ngrokUrl})).catch((e=>{console.log(e)}))}}};const Mt=(0,Z.Z)(Ft,[["render",At]]);var Lt=Mt;const $t={class:"DeviceApp"},Rt=(0,a.createStaticVNode)('<h2 data-v-31244d70>Device Setup</h2><h3 data-v-31244d70>Remote access</h3><p data-v-31244d70> Ngrok is used to expose the device to the internet. To set up Ngrok, follow these steps: <ol data-v-31244d70><li data-v-31244d70>Sign up for an Ngrok account at <a href="https://ngrok.com" target="_blank" data-v-31244d70>https://ngrok.com</a>.</li><li data-v-31244d70>Obtain your Ngrok authentication token from the Ngrok dashboard.</li><li data-v-31244d70>In the remote tab, enter your Ngrok authentication token and click connect.</li><li data-v-31244d70>Ngrok will now create a tunnel to your device, providing a public URL to access it remotely.</li></ol></p><h2 data-v-31244d70>Calibration</h2><h5 data-v-31244d70>Enable calibration mode in the device tab</h5><h3 data-v-31244d70>OD Sensors Calibration</h3><p data-v-31244d70> To calibrate OD sensors, follow these steps: <ol data-v-31244d70><li data-v-31244d70>Prepare probes of known OD transparencies using different pieces of paper or other materials.</li><li data-v-31244d70>Label each probe with a unique ID.</li><li data-v-31244d70>Place each probe in the device and measure the signal it produces.</li><li data-v-31244d70>Prepare a culture with a known OD value.</li><li data-v-31244d70>Dilute the culture until it produces the same signal as the probe.</li><li data-v-31244d70>Measure the OD of the diluted culture and label the probe with this OD value.</li></ol></p><h3 data-v-31244d70>Stirrers Calibration</h3><p data-v-31244d70> To calibrate stirrers, follow these steps: <ul data-v-31244d70><li data-v-31244d70>Set the stirrer to high speed. Drag the slider until you observe a deep vortex without the stirrer detaching and rattling.</li><li data-v-31244d70>Set the stirrer to low speed. Drag the slider until the stirrer is spinning slowly without getting stuck.</li></ul></p><h3 data-v-31244d70>Pumps Calibration</h3><p data-v-31244d70> To calibrate pumps, follow these steps: <ol data-v-31244d70><li data-v-31244d70>Measure the pumped volume per rotation at different total amounts of rotations.</li><li data-v-31244d70>Perform multiple iterations for small amounts of rotations:</li><ul data-v-31244d70><li data-v-31244d70>1 rotation - 50 iterations</li><li data-v-31244d70>5 rotations - 10 iterations</li><li data-v-31244d70>10 rotations - 5 iterations</li><li data-v-31244d70>50 rotations - 1 iteration</li></ul><li data-v-31244d70>The measured values should decrease from approximately 0.2ml/rot to around 0.17ml/rot.</li></ol></p>',11),Ut=[Rt];function jt(e,t,o,n,r,i){return(0,a.openBlock)(),(0,a.createElementBlock)("div",$t,Ut)}var Zt={name:"DeviceApp"};const qt=(0,Z.Z)(Zt,[["render",jt],["__scopeId","data-v-31244d70"]]);var zt=qt,Ht={name:"App",computed:{...(0,c.rn)(["hostname"])},async mounted(){await this.$store.dispatch("fetchHostname"),document.title=this.hostname},components:{ExperimentTab:Dt,DeviceControl:Ge,NgrokTab:Lt,HelpTab:zt},data(){return{currentTab:"Experiment",tabs:["Experiment","Device","Remote","Help"]}}};const Xt=(0,Z.Z)(Ht,[["render",s]]);var Yt=Xt;let Gt=window.location.origin+"/flask";const Kt=Ot.Z.create({baseURL:Gt});console.log("Created flaskAxios with baseURL: "+window.location.origin+"/flask");var Wt={namespaced:!0,state:{calibrationModeEnabled:!1,valves:{states:{1:"open",2:"open",3:"open",4:"open",5:"open",6:"open",7:"open"}},pumps:{states:{1:"stopped",2:"stopped",3:"stopped"},volume:{1:null,2:null,3:null,4:null},calibration:{1:{1:.2,5:.19,10:.18,50:.17},2:{1:.2,5:.19,10:.18,50:.17},3:{1:.2,5:.19,10:.18,50:.17},4:{1:.2,5:.19,10:.18,50:.17}}},stirrers:{states:{1:"stopped",2:"high",3:"low",4:"stopped",5:"stopped",6:"stopped",7:"stopped"},calibration:{1:{low:.4,high:.5},2:{low:.4,high:.5},3:{low:.4,high:.5},4:{low:.4,high:.5},5:{low:.4,high:.5},6:{low:.4,high:.5},7:{low:.4,high:.5}}},ods:{states:{1:0,2:0,3:0,4:0,5:0,6:0,7:0},odsignals:{1:0,2:0,3:0,4:0,5:0,6:0,7:0},calibration_coefs:{1:[4,1,10,-.5,4],2:[4,1,10,-.5,4],3:[4,1,10,-.5,4],4:[4,1,10,-.5,4],5:[4,1,10,-.5,4],6:[4,1,10,-.5,4],7:[4,1,10,-.5,4]},calibration:{1:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},2:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},3:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},4:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},5:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},6:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},7:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648}}},thermometers:{states:{1:0,2:0}}},mutations:{setPartCalibration(e,{devicePart:t,partIndex:o,newCalibration:a,coefs:n}){e[t].calibration[o]=a,n&&(e[t].calibration_coefs[o]=n)},setPartState(e,{devicePart:t,partIndex:o,newState:a}){e[t].states[o]=a},setAllDeviceStates(e,t){e.valves=t.valves,e.pumps=t.pumps,e.stirrers=t.stirrers,e.ods=t.ods,e.odsignals=t.odsignals,e.temperatures=t.temperatures},toggleCalibrationMode(e){e.calibrationModeEnabled=!e.calibrationModeEnabled},removeODCalibrationRow(e,t){const o=Object.keys(e.ods.calibration);o.forEach((o=>{delete e.ods.calibration[o][t]}))},updateODCalibrationValue(e,{od:t,odsIndex:o,newValue:a}){""===a?delete e.ods.calibration[o][t]:e.ods.calibration[o][t]=parseFloat(a)},updateODCalibrationKey(e,{oldOD:t,newOD:o}){console.log(t,o,"change");for(let a=1;a<=7;a++)e.ods.calibration[a]&&e.ods.calibration[a][t]&&(e.ods.calibration[a][o]=e.ods.calibration[a][t],delete e.ods.calibration[a][t])},setDeviceControlEnabled(e,t){e.deviceControlEnabled=t}},actions:{setAllStirrersStateAction({dispatch:e,state:t},o){Object.keys(t.stirrers.states).forEach((t=>{e("setPartStateAction",{devicePart:"stirrers",partIndex:parseInt(t),newState:o})}))},async updateODCalibrationKeyAction({dispatch:e,commit:t,state:o},a){const{oldOD:n,newOD:r}=a;await t("updateODCalibrationKey",{oldOD:n,newOD:r}),console.log(r,o.ods.calibration[1]);for(let i=1;i<=7;i++)await e("setPartCalibrationAction",{devicePart:"ods",partIndex:i,newCalibration:o.ods.calibration[i]}).catch((e=>console.error("Error dispatching setPartCalibrationAction:",e)))},async updateODCalibrationValueAction({dispatch:e,commit:t,state:o},a){const n=a.odsIndex;await t("updateODCalibrationValue",a),await e("setPartCalibrationAction",{devicePart:"ods",partIndex:n,newCalibration:o.ods.calibration[n]}).catch((e=>console.error("Error during updateODCalibrationValueAction:",e)))},async removeODCalibrationRowAction({dispatch:e,commit:t,state:o},a){try{t("removeODCalibrationRow",a);for(let t=1;t<=7;t++)await e("setPartCalibrationAction",{devicePart:"ods",partIndex:t,newCalibration:o.ods.calibration[t]}),console.log(o.ods.calibration[t]," setPartCalibrationAction***********************")}catch(n){console.error("Error removing OD calibration row:",n)}},setPartCalibrationAction({commit:e},t){const{devicePart:o,partIndex:a,newCalibration:n}=t,r=`/set-${o}-calibration`;for(let i in n)null===n[i]&&delete n[i];return new Promise(((t,i)=>{Kt.post(r,{partIndex:a,newCalibration:n}).then((n=>{n.data.success?(console.log(n.data,"response.data from setpartcalibrationaction"),e("setPartCalibration",{devicePart:o,partIndex:a,newCalibration:n.data.newCalibration,coefs:n.data.coefs}),t()):(console.error(`Error updating ${o} calibration:`,n.data.message),i())})).catch((e=>{console.error(`Error updating ${o} calibration:`,e),i()}))}))},measureODCalibrationAction({dispatch:e},t){const{odValue:o}=t,a="/measure-od-calibration";return new Promise(((t,n)=>{Kt.post(a,{odValue:parseFloat(o)}).then((o=>{o.data.success&&e("getAllDeviceData").then((()=>{t()}))})).catch((e=>{console.error("Error updating od calibration:",e),n()}))}))},startPumpCalibrationSequence({dispatch:e},t){const{pumpId:o,rotations:a,iterations:n}=t,r="pumps",i="/start-pump-calibration-sequence";return console.log("startPumpCalibrationSequence",t),new Promise(((t,l)=>{Kt.post(i,{pumpId:o,rotations:a,iterations:n}).then((a=>{a.data.success?e("setPartStateAction",{devicePart:r,partIndex:o,newState:"stopped"}).then((()=>{t()})):(console.error(`Error updating ${r} calibration:`,a.data.message),l())})).catch((e=>{console.error(`Error updating ${r} calibration:`,e),l()}))}))},setPartStateAction({commit:e},t){const{devicePart:o,partIndex:a,newState:n,input:r}=t,i=`/set-${o}-state`;return e("setPartState",{devicePart:o,partIndex:a,newState:n}),new Promise(((e,t)=>{Kt.post(`${i}`,{partIndex:a,newState:n,input:r}).then((o=>{o.data.success?e():t()})).catch((e=>{console.error(`Error updating ${o} state:`,e),t()}))}))},connect(){return new Promise(((e,t)=>{console.log("connect device request",Kt),Kt.post("/connect-device").then((o=>{o.data.success?e(o):(console.error("Error connecting device: server responded with an error"),t())})).catch((e=>{console.error("Error connecting device:",e),t(e)}))}))},getAllDeviceData({commit:e}){return new Promise(((t,o)=>{Kt.get("/get-all-device-data").then((a=>{a.data.success?(e("setAllDeviceStates",a.data.device_states),t()):(console.error("Error fetching device data: server responded with an error"),o())})).catch((e=>{console.error("Error fetching device data:",e),o(e)}))}))},measureDevicePart({commit:e},t){const{devicePart:o,partIndex:a}=t,n=`/measure-${o}`;return new Promise(((t,r)=>{Kt.post(n,{partIndex:a}).then((a=>{a.data.success?(e("setAllDeviceStates",a.data.device_states),t()):(console.error(`Error measuring ${o}:`,a.data.message),r())})).catch((e=>{console.error(`Error measuring ${o}:`,e),r()}))}))}}};let Jt=window.location.origin+"/flask";const Qt=Ot.Z.create({baseURL:Jt});var eo={namespaced:!0,state:{hostname:"replifactory_GUI",errorMessage:null,experiments:[],currentExperiment:{id:null,name:null,parameters:null,data:{}},plot_data:{1:null,2:null,3:null,4:null,5:null,6:null,7:null}},mutations:{setExperiments(e,t){e.experiments=t},setCurrentExperiment(e,t){e.currentExperiment=t},setExperimentPlotData(e,{data:t,vial:o}){console.log(t,o,"data,vial replacing current:",e.plot_data[o]),e.plot_data[o]=t},setCurrentExperimentParameters(e,t){e.currentExperiment.parameters=t}},actions:{async fetchExperiments({commit:e}){console.log("fetchExperiments");const t=await Qt.get("/experiments");e("setExperiments",t.data)},async fetchCulturePlot({commit:e,state:t},o){if(console.log(`fetchCulturePlot for vial ${o}`),!t.plot_data)return void console.log("Current experiment or its plot data is not defined");const a=await Qt.get(`/plot/${o}`),n=a.data;e("setExperimentPlotData",{data:JSON.parse(n).data,vial:o})},async setCurrentExperimentAction({commit:e,state:t},o){if(console.log("setCurrentExperimentAction"),o!==t.currentExperiment.id){const t=await Qt.get(`/experiments/${o}`);e("setCurrentExperiment",t.data)}},async createExperiment({dispatch:e},t){console.log("createExperiment");const o=await Qt.post("/experiments",t);return await e("fetchExperiments"),await e("setCurrentExperimentAction",o.data.id),o.data.id},async updateExperimentParameters({commit:e,state:t},{parameters:o}){console.log("updateExperimentParameters",t.currentExperiment.id,o),e("setCurrentExperimentParameters",o),await Qt.put(`/experiments/${t.currentExperiment.id}/parameters`,{parameters:t.currentExperiment.parameters})},async fetchCurrentExperiment({commit:e}){console.log("fetchCurrentExperiment");const t=await Qt.get("/experiments/current");e("setCurrentExperiment",t.data)},async reloadExperimentParameters({commit:e,state:t}){const o=await Qt.get(`/experiments/${t.currentExperiment.id}`);e("setCurrentExperiment",o.data)},async startExperiment({dispatch:e},t){console.log("startExperiment");try{const o=await Qt.put(`/experiments/${t}/status`,{status:"running"});o.data.message?(console.log(o.data.message),e("reloadExperimentParameters")):o.data.error&&(console.error(o.data.error),this.errorMessage=o.data.error)}catch(o){console.error(o),this.errorMessage="An error occurred while starting the experiment."}},async pauseExperiment({dispatch:e,state:t},o){"stopped"===t.currentExperiment.status&&await Qt.put(`/experiments/${o}/status`,{status:"running"}),await Qt.put(`/experiments/${o}/status`,{status:"paused"}),e("reloadExperimentParameters")},async stopExperiment({dispatch:e},t){await Qt.put(`/experiments/${t}/status`,{status:"stopped"}),e("reloadExperimentParameters")}}};a["default"].use(c.ZP);let to=window.location.origin+"/flask";const oo=Ot.Z.create({baseURL:to});var ao=new c.ZP.Store({state:{deviceConnected:!1,deviceControlEnabled:!0,experimentRunning:null,hostname:"replifactory_GUI"},modules:{device:Wt,experiment:eo},mutations:{setExperiments(e,t){e.experiments=t},setDeviceConnected(e,t){e.deviceConnected=t},setHostname(e,t){e.hostname=t}},actions:{async fetchHostname({commit:e}){const t=await oo.get("/hostname");e("setHostname",t.data.hostname)},async connectDevice({dispatch:e,commit:t}){try{const o=await e("device/connect");o&&o.data.success?(await e("device/getAllDeviceData"),t("setDeviceConnected",!0)):t("setDeviceConnected",!1)}catch(o){console.log(o),t("setDeviceConnected",!1)}}}}),no=o(51682),ro=o(33017);const io=(0,a.createApp)(Yt);io.directive("click-outside",{beforeMount(e,t){e.clickOutsideEvent=o=>{e===o.target||e.contains(o.target)||o.target.classList.contains("input")||t.value()},document.addEventListener("click",e.clickOutsideEvent)},beforeUnmount(e){document.removeEventListener("click",e.clickOutsideEvent)}}),io.use(N.CoreuiVue).use(no.XG7).use(ro.A7).use(ao).mount("#app")},52361:function(){},94616:function(){}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,o),r.exports}o.m=e,function(){var e=[];o.O=function(t,a,n,r){if(!a){var i=1/0;for(d=0;d<e.length;d++){a=e[d][0],n=e[d][1],r=e[d][2];for(var l=!0,s=0;s<a.length;s++)(!1&r||i>=r)&&Object.keys(o.O).every((function(e){return o.O[e](a[s])}))?a.splice(s--,1):(l=!1,r<i&&(i=r));if(l){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,n,r]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,a){var n,r,i=a[0],l=a[1],s=a[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(n in l)o.o(l,n)&&(o.m[n]=l[n]);if(s)var d=s(o)}for(t&&t(a);c<i.length;c++)r=i[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},a=self["webpackChunkreplifactory_gui"]=self["webpackChunkreplifactory_gui"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[998],(function(){return o(10041)}));a=o.O(a)})();
//# sourceMappingURL=app.9b787016.js.map