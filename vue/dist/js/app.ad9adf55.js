(function(){var e={35358:function(e,t,a){var n={"./af":25177,"./af.js":25177,"./ar":61509,"./ar-dz":41488,"./ar-dz.js":41488,"./ar-kw":58676,"./ar-kw.js":58676,"./ar-ly":42353,"./ar-ly.js":42353,"./ar-ma":24496,"./ar-ma.js":24496,"./ar-sa":60301,"./ar-sa.js":60301,"./ar-tn":89756,"./ar-tn.js":89756,"./ar.js":61509,"./az":95533,"./az.js":95533,"./be":28959,"./be.js":28959,"./bg":47777,"./bg.js":47777,"./bm":54903,"./bm.js":54903,"./bn":61290,"./bn-bd":17357,"./bn-bd.js":17357,"./bn.js":61290,"./bo":31545,"./bo.js":31545,"./br":11470,"./br.js":11470,"./bs":44429,"./bs.js":44429,"./ca":7306,"./ca.js":7306,"./cs":56464,"./cs.js":56464,"./cv":73635,"./cv.js":73635,"./cy":64226,"./cy.js":64226,"./da":93601,"./da.js":93601,"./de":77853,"./de-at":26111,"./de-at.js":26111,"./de-ch":54697,"./de-ch.js":54697,"./de.js":77853,"./dv":60708,"./dv.js":60708,"./el":54691,"./el.js":54691,"./en-au":53872,"./en-au.js":53872,"./en-ca":28298,"./en-ca.js":28298,"./en-gb":56195,"./en-gb.js":56195,"./en-ie":66584,"./en-ie.js":66584,"./en-il":65543,"./en-il.js":65543,"./en-in":9033,"./en-in.js":9033,"./en-nz":79402,"./en-nz.js":79402,"./en-sg":43004,"./en-sg.js":43004,"./eo":32934,"./eo.js":32934,"./es":97650,"./es-do":20838,"./es-do.js":20838,"./es-mx":17730,"./es-mx.js":17730,"./es-us":56575,"./es-us.js":56575,"./es.js":97650,"./et":3035,"./et.js":3035,"./eu":3508,"./eu.js":3508,"./fa":119,"./fa.js":119,"./fi":90527,"./fi.js":90527,"./fil":95995,"./fil.js":95995,"./fo":52477,"./fo.js":52477,"./fr":85498,"./fr-ca":26435,"./fr-ca.js":26435,"./fr-ch":15511,"./fr-ch.js":15511,"./fr.js":85498,"./fy":37071,"./fy.js":37071,"./ga":41734,"./ga.js":41734,"./gd":70217,"./gd.js":70217,"./gl":77329,"./gl.js":77329,"./gom-deva":32124,"./gom-deva.js":32124,"./gom-latn":93383,"./gom-latn.js":93383,"./gu":95050,"./gu.js":95050,"./he":11713,"./he.js":11713,"./hi":43861,"./hi.js":43861,"./hr":26308,"./hr.js":26308,"./hu":90609,"./hu.js":90609,"./hy-am":17160,"./hy-am.js":17160,"./id":74063,"./id.js":74063,"./is":89374,"./is.js":89374,"./it":88383,"./it-ch":21827,"./it-ch.js":21827,"./it.js":88383,"./ja":23827,"./ja.js":23827,"./jv":89722,"./jv.js":89722,"./ka":41794,"./ka.js":41794,"./kk":27088,"./kk.js":27088,"./km":96870,"./km.js":96870,"./kn":84451,"./kn.js":84451,"./ko":63164,"./ko.js":63164,"./ku":98174,"./ku.js":98174,"./ky":78474,"./ky.js":78474,"./lb":79680,"./lb.js":79680,"./lo":15867,"./lo.js":15867,"./lt":45766,"./lt.js":45766,"./lv":69532,"./lv.js":69532,"./me":58076,"./me.js":58076,"./mi":41848,"./mi.js":41848,"./mk":30306,"./mk.js":30306,"./ml":73739,"./ml.js":73739,"./mn":99053,"./mn.js":99053,"./mr":86169,"./mr.js":86169,"./ms":73386,"./ms-my":92297,"./ms-my.js":92297,"./ms.js":73386,"./mt":77075,"./mt.js":77075,"./my":72264,"./my.js":72264,"./nb":22274,"./nb.js":22274,"./ne":8235,"./ne.js":8235,"./nl":92572,"./nl-be":43784,"./nl-be.js":43784,"./nl.js":92572,"./nn":54566,"./nn.js":54566,"./oc-lnc":69330,"./oc-lnc.js":69330,"./pa-in":29849,"./pa-in.js":29849,"./pl":94418,"./pl.js":94418,"./pt":79834,"./pt-br":48303,"./pt-br.js":48303,"./pt.js":79834,"./ro":24457,"./ro.js":24457,"./ru":82271,"./ru.js":82271,"./sd":1221,"./sd.js":1221,"./se":33478,"./se.js":33478,"./si":17538,"./si.js":17538,"./sk":5784,"./sk.js":5784,"./sl":46637,"./sl.js":46637,"./sq":86794,"./sq.js":86794,"./sr":45719,"./sr-cyrl":3322,"./sr-cyrl.js":3322,"./sr.js":45719,"./ss":56e3,"./ss.js":56e3,"./sv":41011,"./sv.js":41011,"./sw":40748,"./sw.js":40748,"./ta":11025,"./ta.js":11025,"./te":11885,"./te.js":11885,"./tet":28861,"./tet.js":28861,"./tg":86571,"./tg.js":86571,"./th":55802,"./th.js":55802,"./tk":59527,"./tk.js":59527,"./tl-ph":29231,"./tl-ph.js":29231,"./tlh":31052,"./tlh.js":31052,"./tr":85096,"./tr.js":85096,"./tzl":79846,"./tzl.js":79846,"./tzm":81765,"./tzm-latn":97711,"./tzm-latn.js":97711,"./tzm.js":81765,"./ug-cn":48414,"./ug-cn.js":48414,"./uk":16618,"./uk.js":16618,"./ur":57777,"./ur.js":57777,"./uz":57609,"./uz-latn":72475,"./uz-latn.js":72475,"./uz.js":57609,"./vi":21135,"./vi.js":21135,"./x-pseudo":64051,"./x-pseudo.js":64051,"./yo":82218,"./yo.js":82218,"./zh-cn":52648,"./zh-cn.js":52648,"./zh-hk":1632,"./zh-hk.js":1632,"./zh-mo":31541,"./zh-mo.js":31541,"./zh-tw":50304,"./zh-tw.js":50304};function o(e){var t=r(e);return a(t)}function r(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=r,e.exports=o,o.id=35358},84162:function(e,t,a){"use strict";var n=a(96913);const o={id:"app"},r={class:"nav nav-tabs",id:"myTab"},i=["onClick"],l={class:"tab-content"};function s(e,t,a,s,c,d){const u=(0,n.resolveComponent)("ExperimentTab"),m=(0,n.resolveComponent)("PredictionTab"),p=(0,n.resolveComponent)("DeviceControl"),h=(0,n.resolveComponent)("NgrokTab"),g=(0,n.resolveComponent)("HelpTab"),v=(0,n.resolveComponent)("StatusTab"),b=(0,n.resolveComponent)("LogsTab");return(0,n.openBlock)(),(0,n.createElementBlock)("div",o,[(0,n.createElementVNode)("ul",r,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(c.tabs,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("li",{class:"nav-item",key:e},[(0,n.createElementVNode)("a",{class:(0,n.normalizeClass)(["nav-link",{active:c.currentTab===e}]),href:"#",onClick:t=>c.currentTab=e},(0,n.toDisplayString)(e),11,i)])))),128))]),(0,n.createElementVNode)("div",l,["Experiment"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(u,{key:0})):(0,n.createCommentVNode)("",!0),"Prediction"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(m,{key:1})):(0,n.createCommentVNode)("",!0),"Device"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(p,{key:2})):(0,n.createCommentVNode)("",!0),"Remote"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(h,{key:3})):(0,n.createCommentVNode)("",!0),"Help"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(g,{key:4})):(0,n.createCommentVNode)("",!0),"Status"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(v,{key:5})):(0,n.createCommentVNode)("",!0),"Logs"===c.currentTab?((0,n.openBlock)(),(0,n.createBlock)(b,{key:6})):(0,n.createCommentVNode)("",!0)])])}var c=a(66278);const d={key:0,class:"disconnected-overlay"},u={key:1,class:"centered-text"},m={key:2,class:"experiment-running-overlay"},p={class:"calibration-switch",style:{"text-align":"right"}},h={key:4};function g(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CFormSwitch"),s=(0,n.resolveComponent)("PumpControl"),c=(0,n.resolveComponent)("ValveControl"),g=(0,n.resolveComponent)("StirrerControl"),v=(0,n.resolveComponent)("ODControl");return(0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(["DeviceControl",{"device-disconnected":!1===e.deviceConnected}])},[!1===e.deviceConnected?((0,n.openBlock)(),(0,n.createElementBlock)("div",d)):(0,n.createCommentVNode)("",!0),!1===e.deviceConnected?((0,n.openBlock)(),(0,n.createElementBlock)("div",u," device connection not available ")):(0,n.createCommentVNode)("",!0),!1===e.deviceControlEnabled?((0,n.openBlock)(),(0,n.createElementBlock)("div",m)):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",p,[(0,n.createVNode)(l,{label:"Calibration Mode",id:"formSwitchCheckChecked",modelValue:e.calibrationModeEnabled,"onUpdate:modelValue":t[0]||(t[0]=t=>e.calibrationModeEnabled=t),onChange:e.toggleCalibrationMode},null,8,["modelValue","onChange"])]),e.deviceControlEnabled||r.controlsVisible?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:3},[(0,n.createVNode)(s),(0,n.createVNode)(c),(0,n.createVNode)(g),(0,n.createVNode)(v)],64)):((0,n.openBlock)(),(0,n.createElementBlock)("p",h,"Device Control Disabled - please pause experiment to control device."))],2)}const v=e=>((0,n.pushScopeId)("data-v-178ee40e"),e=e(),(0,n.popScopeId)(),e),b={class:"pump-controls"},C=["onClick"],x={key:0,class:"spinner-border spinner-custom",role:"status"},k={key:1},E=v((()=>(0,n.createElementVNode)("br",null,null,-1))),f={class:"pump-input"},y={class:"form-group"},V={key:0,class:"form-group"};function w(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CFormInput"),s=(0,n.resolveComponent)("PumpCalibration");return(0,n.openBlock)(),(0,n.createElementBlock)("div",b,[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)([1,2,4],(t=>(0,n.createElementVNode)("div",{class:"pump",key:t},[(0,n.createElementVNode)("button",{class:(0,n.normalizeClass)(["pump-button",{"stop-button":"running"===e.pumps.states[t]}]),onClick:e=>i.handlePumpClick(t)},["running"===e.pumps.states[t]?((0,n.openBlock)(),(0,n.createElementBlock)("div",x)):((0,n.openBlock)(),(0,n.createElementBlock)("span",k,[(0,n.createTextVNode)((0,n.toDisplayString)(r.pump_names[t]),1),E,(0,n.createTextVNode)("pump")]))],10,C),(0,n.createElementVNode)("div",f,[(0,n.createElementVNode)("div",y,[(0,n.createVNode)(l,{id:"volume",placeholder:"volume (mL)",type:"number",size:"lg",value:r.volume[t],onInput:e=>i.onVolumeInput(e,t)},null,8,["value","onInput"])]),e.calibrationModeEnabled?((0,n.openBlock)(),(0,n.createElementBlock)("div",V,[(0,n.createVNode)(l,{id:"rotations",placeholder:"rotations",type:"float",size:"sm",value:r.rotations[t],onInput:e=>i.onRotationsInput(e,t)},null,8,["value","onInput"]),(0,n.createVNode)(s,{pumpId:t},null,8,["pumpId"])])):(0,n.createCommentVNode)("",!0)])]))),64))])}var N=a(52994);const B=e=>((0,n.pushScopeId)("data-v-00452574"),e=e(),(0,n.popScopeId)(),e),S={class:"pump-data"},_=B((()=>(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("th",null,"Calibration Sequence"),(0,n.createElementVNode)("th"),(0,n.createElementVNode)("th",null,"Volume (mL)")],-1))),D={class:"iteration-rotation-wrapper"},j={class:"iteration"},I=B((()=>(0,n.createElementVNode)("div",{class:"multiplier"},"x",-1))),T={class:"rotation"},P=["onClick"],A={key:0},O={key:1},F=["onUpdate:modelValue","onChange"],M={class:"chart-container"};function L(e,t,a,o,r,i){const l=(0,n.resolveComponent)("Bar");return(0,n.openBlock)(),(0,n.createElementBlock)("div",S,[(0,n.createElementVNode)("table",null,[_,((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.rows,((e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("tr",{key:t},[(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("div",D,[(0,n.createElementVNode)("div",j,(0,n.toDisplayString)(e.iterations),1),I,(0,n.createElementVNode)("div",T,(0,n.toDisplayString)(e.rotations)+" rots",1)])]),(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("button",{onClick:e=>i.toggleButtonState(t),class:(0,n.normalizeClass)({"stop-button":r.isStopButton[t]})},[r.isStopButton[t]?((0,n.openBlock)(),(0,n.createElementBlock)("span",O,"Stop")):((0,n.openBlock)(),(0,n.createElementBlock)("span",A,"Pump"))],10,P)]),(0,n.createElementVNode)("td",null,[(0,n.withDirectives)((0,n.createElementVNode)("input",{"onUpdate:modelValue":t=>e.total_ml=t,onChange:t=>i.onTotalMlInput(e),type:"float"},null,40,F),[[n.vModelText,e.total_ml]])])])))),128))]),(0,n.createElementVNode)("div",M,[r.chartData.datasets[0].data.length>0?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,id:"pump-calibration-chart",options:r.chartOptions,class:"pump-calibration-chart",data:r.chartData},null,8,["options","data"])):(0,n.createCommentVNode)("",!0)])])}var R=a(44527),z=a(22022);z.t1.register(z.hE,z.m_,z.E8,z.PP,z.kc);var H={components:{Bar:R.yP},data(){return{chartData:{datasets:[{data:[]}]},chartOptions:{responsive:!0,devicePixelRatio:4,maintainAspectRatio:!1,plugins:{legend:{display:!1}},backgroundColor:"rgba(0, 140, 186, 0.3)",layout:{padding:{top:20}},scales:{x:{title:{display:!0,text:"rotations"}},y:{title:{display:!0,text:"mL / rotation"},beginAtZero:!1,suggestedMin:.1,suggestedMax:.22}}},isStopButton:{},rows:[{rotations:1,iterations:50,total_ml:NaN},{rotations:5,iterations:10,total_ml:NaN},{rotations:10,iterations:5,total_ml:NaN},{rotations:50,iterations:1,total_ml:NaN}]}},props:{pumpId:{type:Number,required:!0}},computed:{...(0,c.aH)("device",["calibrationModeEnabled","pumps","valves"]),pumpIdCalibrationData(){return this.pumps?.calibration[this.pumpId]}},methods:{...(0,c.i0)("device",["setPartCalibrationAction","startPumpCalibrationSequence","setPartStateAction"]),createChartData(){return{labels:Object.keys(this.pumpIdCalibrationData),datasets:[{label:null,data:Object.values(this.pumpIdCalibrationData),fill:!1,borderColor:"rgb(75, 192, 192)",tension:.1}]}},updateChartData(){this.chartData=this.createChartData()},toggleButtonState(e){const t=Object.values(this.valves.states).some((e=>"open"===e));t?(this.$set(this.isStopButton,e,!this.isStopButton[e]),this.isStopButton[e]?this.promptForMl(this.rows[e]):this.setPartStateAction({devicePart:"pumps",partIndex:this.pumpId,newState:"stopped"})):alert("At least one valve must be open to start the pump")},resetButton(e){this.$set(this.isStopButton,e,!1)},onTotalMlInput(e){e.total_ml&&(this.pumps.calibration[this.pumpId][e.rotations]=e.total_ml/e.rotations/e.iterations,this.setPartCalibrationAction({devicePart:"pumps",partIndex:this.pumpId,newCalibration:this.pumps.calibration[this.pumpId]}))},promptForMl(e){console.log("starting pump calibration sequence for pumpId: "+this.pumpId),alert("Pumping "+e.rotations+" rotations "+e.iterations+" times. Please blank the scale"),this.startPumpCalibrationSequence({pumpId:this.pumpId,rotations:e.rotations,iterations:e.iterations}).then((()=>{console.log("pump calibration sequence finished"),this.resetButton(e);const t=parseFloat(prompt("Enter total mL pumped"));isNaN(t)||(e.total_ml=t,this.onTotalMlInput(e))}))}},mounted(){this.pumpIdCalibrationData&&this.updateChartData(),this.rows.forEach((e=>{e.total_ml=this.pumps.calibration[this.pumpId][e.rotations]*e.rotations*e.iterations,e.total_ml=e.total_ml.toFixed(2)}))},watch:{pumpIdCalibrationData:{deep:!0,handler(){this.updateChartData()}}}},$=a(66262);const U=(0,$.A)(H,[["render",L],["__scopeId","data-v-00452574"]]);var q=U,G={components:{PumpCalibration:q,CFormInput:N.OG},name:"PumpControl",data(){return{pump_names:{1:"MAIN",2:"DRUG",3:"MISSING!!!",4:"WASTE"},rotations:{1:null,2:null,3:null,4:null},volume:{1:null,2:null,3:null,4:null}}},computed:{...(0,c.aH)("device",["pumps","valves","calibrationModeEnabled"])},methods:{...(0,c.i0)("device",["setPartStateAction"]),async handlePumpClick(e){if("running"===this.pumps.states[e])return void await this.setPartStateAction({devicePart:"pumps",partIndex:e,newState:"stopped"});console.log("handlePumpClick, pumpId: "+e);const t=Object.values(this.valves.states).some((e=>"open"===e));if(!t)return void alert("At least one valve must be open to start the pump");const a=parseFloat(this.volume[e]);if(console.log("volume: "+a),a)try{await this.setPartStateAction({devicePart:"pumps",partIndex:e,newState:"running",input:{volume:a}})}catch(n){console.error(n)}finally{await this.setPartStateAction({devicePart:"pumps",partIndex:e,newState:"stopped"})}else alert("Please set the volume before starting the pump")},onVolumeInput(e,t){this.volume[t]=e.target.value;const a=parseFloat(this.volume[t]);isNaN(a)?this.rotations[t]="":this.rotations[t]=this.calculateRotations(a,t).toFixed(2)},onRotationsInput(e,t){this.rotations[t]=e.target.value;const a=parseFloat(this.rotations[t]);isNaN(a)?this.volume[t]="":this.volume[t]=this.calculateVolume(a,t)},calculateRotations(e,t){const a=this.pumps.calibration[t],n=Object.entries(a).map((([e,t])=>[parseInt(e),t])).sort(((e,t)=>e[0]-t[0]));if(e>=n[n.length-1][0]*n[n.length-1][1])return e/n[n.length-1][1];let o=n[0],r=n[n.length-1];for(let u=0;u<n.length-1;u++)if(e>=n[u][0]*n[u][1]&&e<=n[u+1][0]*n[u+1][1]){o=n[u],r=n[u+1];break}const i=o[0]*o[1],l=r[0]*r[1],s=(e-i)/(l-i),c=o[1]+(r[1]-o[1])*s,d=e/c;return d},calculateVolume(e,t){const a=this.pumps.calibration[t],n=Object.entries(a).map((([e,t])=>[parseInt(e),t])).sort(((e,t)=>e[0]-t[0]));if(e>=n[n.length-1][0])return(e*n[n.length-1][1]).toFixed(2);let o=n[0],r=n[n.length-1];for(let c=0;c<n.length-1;c++)if(e>=n[c][0]&&e<=n[c+1][0]){o=n[c],r=n[c+1];break}const i=(e-o[0])/(r[0]-o[0]),l=o[1]+(r[1]-o[1])*i,s=e*l;return s.toFixed(2)}}};const Y=(0,$.A)(G,[["render",w],["__scopeId","data-v-178ee40e"]]);var X=Y;const K={class:"valve-controls"},W=["onClick","disabled"],Q={key:0,class:"spinner-border spinner-custom",role:"status"},J={key:1};function Z(e,t,a,o,r,i){return(0,n.openBlock)(),(0,n.createElementBlock)("div",K,[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(7,(t=>(0,n.createElementVNode)("button",{class:(0,n.normalizeClass)(["btn",{"btn-danger":"closed"===e.valves.states[t]&&!r.togglingValves[t],"btn-success":"open"===e.valves.states[t]&&!r.togglingValves[t],"btn-warning":r.togglingValves[t]}]),key:t,onClick:e=>i.toggleValve(t),disabled:r.togglingValves[t]},[r.togglingValves[t]?((0,n.openBlock)(),(0,n.createElementBlock)("div",Q)):((0,n.openBlock)(),(0,n.createElementBlock)("span",J,"Valve "+(0,n.toDisplayString)(t),1))],10,W))),64))])}var ee={name:"ValveControl",computed:(0,c.aH)("device",["valves"]),data(){return{audioContext:new(window.AudioContext||window.webkitAudioContext),togglingValves:{}}},methods:{...(0,c.i0)("device",["setPartStateAction"]),toggleValve(e){const t=this.valves.states[e];if(this.togglingValves[e])return;this.togglingValves={...this.togglingValves,[e]:!0};const a=this.playValveSound(t);this.setPartStateAction({devicePart:"valves",partIndex:e,newState:"open"===t?"closed":"open"}).then((()=>{a.stop(),this.togglingValves={...this.togglingValves,[e]:!1}})).catch((e=>{console.error(e)}))},playValveSound(e){const t="open"===e?500:300,a="open"===e?300:500,n=this.audioContext.createOscillator();n.type="sine";const o=this.audioContext.createGain();return o.gain.setValueAtTime(.1,this.audioContext.currentTime),n.connect(o),o.connect(this.audioContext.destination),n.frequency.setValueAtTime(t,this.audioContext.currentTime),n.frequency.linearRampToValueAtTime(a,this.audioContext.currentTime+.3),n.start(),n.stop(this.audioContext.currentTime+.3),n}}};const te=(0,$.A)(ee,[["render",Z],["__scopeId","data-v-f781ac02"]]);var ae=te;const ne={class:"stirrer-controls"};function oe(e,t,a,o,r,i){const l=(0,n.resolveComponent)("StirrerCalibration");return(0,n.openBlock)(),(0,n.createElementBlock)("div",ne,[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(7,(e=>(0,n.createVNode)(l,{key:e,stirrerId:e},null,8,["stirrerId"]))),64))])}const re={class:"stirrer-calibrator",ref:"container"},ie={class:"elements-container"},le={class:"stirrer-name"},se={key:0},ce=["min","max"],de=["min","max"],ue={class:"svg-container"},me=["x1","y1","x2","y2"],pe=["x1","y1","x2","y2"],he={class:"buttons-container"};function ge(e,t,a,o,r,i){return(0,n.openBlock)(),(0,n.createElementBlock)("div",re,[(0,n.createElementVNode)("div",ie,[(0,n.createElementVNode)("div",le,[(0,n.createElementVNode)("header",null,"Stirrer "+(0,n.toDisplayString)(a.stirrerId),1)]),e.calibrationModeEnabled?((0,n.openBlock)(),(0,n.createElementBlock)("div",se,[(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"range",class:(0,n.normalizeClass)(["slider slider-high",{active:"high"===i.currentStirrerState}]),min:r.min,max:r.max,step:.01,"onUpdate:modelValue":t[0]||(t[0]=t=>e.stirrers.calibration[a.stirrerId].high=t),onChange:t[1]||(t[1]=e=>i.onSliderChange("high",e)),onInput:t[2]||(t[2]=e=>i.onSliderInput("high",e))},null,42,ce),[[n.vModelText,e.stirrers.calibration[a.stirrerId].high]]),(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"range",class:(0,n.normalizeClass)(["slider slider-low",{active:"low"===i.currentStirrerState}]),min:r.min,max:r.max,step:.01,"onUpdate:modelValue":t[3]||(t[3]=t=>e.stirrers.calibration[a.stirrerId].low=t),onChange:t[4]||(t[4]=e=>i.onSliderChange("low",e)),onInput:t[5]||(t[5]=e=>i.onSliderInput("low",e))},null,42,de),[[n.vModelText,e.stirrers.calibration[a.stirrerId].low]]),((0,n.openBlock)(),(0,n.createElementBlock)("svg",ue,[(0,n.createElementVNode)("line",{x1:r.lowX1,y1:r.lowY1,x2:r.lowX2,y2:r.lowY2,stroke:"gray","stroke-width":"1"},null,8,me),(0,n.createElementVNode)("line",{x1:r.highX1,y1:r.highY1,x2:r.highX2,y2:r.highY2,stroke:"gray","stroke-width":"1"},null,8,pe)]))])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",he,[(0,n.createElementVNode)("button",{class:(0,n.normalizeClass)(["button button-high",{active:"high"===i.currentStirrerState}]),ref:"buttonHigh",onClick:t[6]||(t[6]=e=>i.onClick("high")),onDblclick:t[7]||(t[7]=e=>i.onDoubleClick("high"))}," High ",34),(0,n.createElementVNode)("button",{class:(0,n.normalizeClass)(["button button-low",{active:"low"===i.currentStirrerState}]),ref:"buttonLow",onClick:t[8]||(t[8]=e=>i.onClick("low")),onDblclick:t[9]||(t[9]=e=>i.onDoubleClick("low"))}," Low ",34),(0,n.createElementVNode)("button",{class:(0,n.normalizeClass)(["button button-off",{active:"stopped"===i.currentStirrerState}]),ref:"buttonOff",onClick:t[10]||(t[10]=e=>i.onClick("stopped")),onDblclick:t[11]||(t[11]=e=>i.onDoubleClick("stopped"))}," OFF ",34)])])],512)}var ve={name:"StirrerCalibration",props:{stirrerId:{type:Number,required:!0}},watch:{calibrationModeEnabled(e){e&&this.$nextTick(this.updateLine)}},data(){return{min:0,max:1,lowX1:0,lowY1:0,lowX2:0,lowY2:0,highX1:0,highY1:0,highX2:0,highY2:0,audioContext:new(window.AudioContext||window.webkitAudioContext),oscillator:null,gainNode:null,stopSoundTimeout:null}},computed:{...(0,c.aH)("device",["calibrationModeEnabled","stirrers"]),currentStirrerState(){return this.stirrers.states[this.stirrerId]}},methods:{...(0,c.i0)("device",["setPartStateAction","setPartCalibrationAction","getAllDeviceData","setAllStirrersStateAction"]),onClick(e){this.setPartStateAction({devicePart:"stirrers",partIndex:this.stirrerId,newState:e})},onDoubleClick(e){this.setAllStirrersStateAction(e)},onSliderChange(e,t){"low"===e?this.stirrers.calibration[this.stirrerId].low=parseFloat(t.target.value):"high"===e&&(this.stirrers.calibration[this.stirrerId].high=parseFloat(t.target.value)),this.setPartCalibrationAction({devicePart:"stirrers",partIndex:this.stirrerId,newCalibration:{low:this.stirrers.calibration[this.stirrerId].low,high:this.stirrers.calibration[this.stirrerId].high}}).catch((e=>{console.error("Error updating stirrer calibration:",e)}))},onSliderInput(e,t){"low"===e?this.stirrers.calibration[this.stirrerId].low=parseFloat(t.target.value):"high"===e&&(this.stirrers.calibration[this.stirrerId].high=parseFloat(t.target.value)),this.updateLine(),this.playSound(t.target.value)},updateLine(){this.$nextTick((()=>{const e=this.$refs.container,t=e.getBoundingClientRect(),a=this.$el.querySelector(".slider-low"),n=this.$refs.buttonLow,o=a.getBoundingClientRect(),r=n.getBoundingClientRect();this.lowX1=o.x-t.x+o.width/2,this.lowY1=o.y-t.y+o.height*(1-this.stirrers.calibration[this.stirrerId].low/(this.max-this.min)),this.lowX2=r.x-t.x,this.lowY2=r.y-t.y+r.height/2;const i=this.$el.querySelector(".slider-high"),l=this.$refs.buttonHigh,s=i.getBoundingClientRect(),c=l.getBoundingClientRect();this.highX1=s.x-t.x+s.width/2,this.highY1=s.y-t.y+s.height*(1-this.stirrers.calibration[this.stirrerId].high/(this.max-this.min)),this.highX2=c.x-t.x,this.highY2=c.y-t.y+c.height/2}))},playSound(e){this.oscillator||(this.oscillator=this.audioContext.createOscillator(),this.gainNode=this.audioContext.createGain(),this.oscillator.type="sine",this.gainNode.gain.setValueAtTime(.1,this.audioContext.currentTime),this.oscillator.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination),this.oscillator.start());const t=300+500*e;this.oscillator.frequency.setValueAtTime(t,this.audioContext.currentTime),this.stopSoundTimeout&&clearTimeout(this.stopSoundTimeout),this.stopSoundTimeout=setTimeout(this.stopSound,200)},stopSound(){this.oscillator&&(this.gainNode.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+.01),this.gainNode.gain.setValueAtTime(.1,this.audioContext.currentTime+.02),this.oscillator.stop(this.audioContext.currentTime+.02),this.oscillator=null,this.gainNode=null)}}};const be=(0,$.A)(ve,[["render",ge],["__scopeId","data-v-d360c050"]]);var Ce=be,xe={name:"StirrerControl",components:{StirrerCalibration:Ce}};const ke=(0,$.A)(xe,[["render",oe],["__scopeId","data-v-4030e64e"]]);var Ee=ke;const fe=e=>((0,n.pushScopeId)("data-v-0dc56327"),e=e(),(0,n.popScopeId)(),e),ye={class:"od-control-container"},Ve=["onClick"],we={key:0,class:"od-output-value"},Ne=fe((()=>(0,n.createElementVNode)("div",{style:{height:"0.5px"}},null,-1))),Be={key:1,class:"signal-output-value"},Se={key:0},_e=fe((()=>(0,n.createElementVNode)("th",null,"OD value",-1))),De=fe((()=>(0,n.createElementVNode)("th",null,null,-1))),je=fe((()=>(0,n.createElementVNode)("th",null,null,-1))),Ie=["value","onChange"],Te=["onClick"],Pe=["onChange","onUpdate:modelValue"],Ae=["disabled","onClick"],Oe={class:"chart-container"};function Fe(e,t,a,o,r,i){const l=(0,n.resolveComponent)("ODChart");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[(0,n.createElementVNode)("div",ye,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.ods.states,((t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{class:"elements-container",key:a},[(0,n.createElementVNode)("button",{class:"od-button",onClick:e=>i.handleOdClick(a)},[(0,n.createElementVNode)("span",null,"OD "+(0,n.toDisplayString)(a),1)],8,Ve),e.ods.states&&void 0!==e.ods.states[a]?((0,n.openBlock)(),(0,n.createElementBlock)("span",we,(0,n.toDisplayString)(parseFloat(e.ods.states[a].toFixed(2))),1)):(0,n.createCommentVNode)("",!0),Ne,e.ods.odsignals&&void 0!==e.ods.odsignals[a]?((0,n.openBlock)(),(0,n.createElementBlock)("span",Be,"("+(0,n.toDisplayString)(parseFloat(e.ods.odsignals[a].toFixed(2)))+"mV)",1)):(0,n.createCommentVNode)("",!0)])))),128))]),e.calibrationModeEnabled?((0,n.openBlock)(),(0,n.createElementBlock)("div",Se,[(0,n.createElementVNode)("table",null,[(0,n.createElementVNode)("thead",null,[(0,n.createElementVNode)("tr",null,[_e,De,((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.vials,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("th",{key:e},(0,n.toDisplayString)("vial "+e),1)))),128)),je])]),(0,n.createElementVNode)("tbody",null,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.allOdValues,(t=>((0,n.openBlock)(),(0,n.createElementBlock)("tr",{key:t},[(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("input",{value:t,onChange:a=>e.updateODCalibrationKeyAction({oldOD:t,newOD:a.target.value}),type:"number",step:"0.1"},null,40,Ie)]),(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("button",{onClick:a=>e.measureODCalibrationAction({odValue:t})},"Measure",8,Te)]),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.vials,(a=>((0,n.openBlock)(),(0,n.createElementBlock)("td",{key:a},[(0,n.withDirectives)((0,n.createElementVNode)("input",{class:"calibration-signal",onChange:n=>e.updateODCalibrationValueAction({od:t,odsIndex:a,newValue:n.target.value}),"onUpdate:modelValue":n=>e.ods.calibration[a][t]=n,type:"number",style:{opacity:"60%"}},null,40,Pe),[[n.vModelText,e.ods.calibration[a][t]]])])))),128)),(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("button",{class:"button button-delete",disabled:r.isLoading,onClick:e=>i.handleDeleteRowClick(t)},"Delete Row",8,Ae)])])))),128)),(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("td",null,[(0,n.withDirectives)((0,n.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.newRowValue=e),type:"number",step:"0.1"},null,512),[[n.vModelText,r.newRowValue]])]),(0,n.createElementVNode)("td",null,[(0,n.createElementVNode)("button",{class:"button button-new",onClick:t[1]||(t[1]=t=>e.measureODCalibrationAction({odValue:r.newRowValue}))},"Measure new probe")])])])]),(0,n.createElementVNode)("div",Oe,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.vials,(e=>((0,n.openBlock)(),(0,n.createBlock)(l,{partId:e,key:e},null,8,["partId"])))),128))])])):(0,n.createCommentVNode)("",!0)],64)}a(43375),a(39225),a(13972),a(99209),a(25714),a(17561),a(66197);const Me={className:"single-chart-container"};function Le(e,t,a,o,r,i){const l=(0,n.resolveComponent)("Scatter");return(0,n.openBlock)(),(0,n.createElementBlock)("div",Me,[(0,n.createVNode)(l,{data:i.chartData,options:i.chartOptions},null,8,["data","options"])])}a(44114);function Re(e,t,a,n,o,r){return o+(t-o)/Math.pow(1+Math.pow(e/n,a),r)}z.t1.register(z.hE,z.m_,z.s$,z.No,z.PP,z.kc,z.FN);var ze={name:"LineChart",components:{Scatter:R.Xl},props:{partId:{type:Number,required:!0}},computed:{...(0,c.aH)("device",["ods","calibrationModeEnabled"]),calibrationData(){return this.ods?.calibration[this.partId]},calibrationCoefs(){return this.ods?.calibration_coefs[this.partId]},currentOD(){return{od:this.ods?.states[this.partId],signal:this.ods?.odsignals[this.partId]}},chartData(){if(this.calibrationData&&"object"===typeof this.calibrationData&&this.calibrationCoefs){const e=Object.entries(this.calibrationData).map((([e,t])=>({x:Number(t),y:Number(e)}))).sort(((e,t)=>e.x-t.x)),t=Math.min(...e.map((e=>e.x))),a=Math.max(...e.map((e=>e.x))),n=[];for(let o=t;o<=a;o+=.1){const e=Re(o,...this.calibrationCoefs);n.push({x:o,y:e})}return{datasets:[{label:`Vial ${this.partId} Calibration OD`,data:e,borderColor:"#607ecb",backgroundColor:"rgba(83,158,255,0.64)"},{label:`Vial ${this.partId} Current OD`,data:[{x:this.currentOD.signal,y:this.currentOD.od}],pointRadius:5,backgroundColor:"rgba(255,1,60,0.64)"},{label:`Vial ${this.partId} Fit`,data:n,pointRadius:0,borderColor:"rgba(0,70,220,0.38)",borderWidth:2,showLine:!0,fill:!1,borderDash:[2,2]}]}}return{}},chartOptions(){return{devicePixelRatio:4,responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},title:{display:!0,text:`Vial ${this.partId}`}},scales:{x:{title:{display:!0,text:"Signal (mV)"},suggestedMin:0},y:{title:{display:!0,text:"OD"},suggestedMax:1.5,suggestedMin:0}}}}}};const He=(0,$.A)(ze,[["render",Le]]);var $e=He,Ue={components:{ODChart:$e},data(){return{vials:[1,2,3,4,5,6,7],newRowValue:null,isLoading:!1}},computed:{...(0,c.aH)("device",["ods","calibrationModeEnabled"]),allOdValues(){let e=new Set;for(let t in this.ods.calibration)for(let a in this.ods.calibration[t])e.add(a);return Array.from(e)}},methods:{...(0,c.i0)("device",["getAllDeviceData","setPartStateAction","measureDevicePart","measureODCalibrationAction","setPartCalibrationAction","removeODCalibrationRowAction","updateODCalibrationKeyAction","updateODCalibrationValueAction"]),async handleOdClick(e){await this.measureDevicePart({devicePart:"ods",partIndex:e}).then((()=>{this.getAllDeviceData()}))},async handleDeleteRowClick(e){this.isLoading=!0;try{await this.removeODCalibrationRowAction(e)}catch(t){console.log(t)}finally{this.isLoading=!1}}}};const qe=(0,$.A)(Ue,[["render",Fe],["__scopeId","data-v-0dc56327"]]);var Ge=qe,Ye={components:{PumpControl:X,ValveControl:ae,StirrerControl:Ee,ODControl:Ge,CFormSwitch:N.Qb},computed:{...(0,c.aH)(["deviceConnected","deviceControlEnabled"]),...(0,c.aH)("device",["calibrationModeEnabled","stirrers","pumps","valves","ods"])},data(){return{controlsVisible:!1}},watch:{deviceControlEnabled(e){this.controlsVisible=!!e}},mounted(){this.deviceConnected||this.connectDevice().then((()=>{this.getAllDeviceData().then((()=>{}))}))},methods:{...(0,c.PY)("device",["toggleCalibrationMode","setDeviceControlEnabled"]),...(0,c.i0)("device",["getAllDeviceData"]),...(0,c.i0)(["connectDevice"])}};const Xe=(0,$.A)(Ye,[["render",g],["__scopeId","data-v-f93cb42c"]]);var Ke=Xe;function We(e,t,a,o,r,i){const l=(0,n.resolveComponent)("ExperimentSetup"),s=(0,n.resolveComponent)("ExperimentChart");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.createVNode)(l),Object.keys(e.currentExperiment?.parameters?.cultures||{}).length>0?((0,n.openBlock)(),(0,n.createBlock)(s,{key:0})):(0,n.createCommentVNode)("",!0)])}const Qe={class:"experiment-setup"},Je={class:"d-flex"},Ze=["value"],et={class:"button-container"},tt={key:0,class:"d-flex"},at={key:1};function nt(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CToastHeader"),s=(0,n.resolveComponent)("CToastBody"),c=(0,n.resolveComponent)("CToast"),d=(0,n.resolveComponent)("CFormSelect"),u=(0,n.resolveComponent)("CFormFloating"),m=(0,n.resolveComponent)("CButton"),p=(0,n.resolveComponent)("CFormInput"),h=(0,n.resolveComponent)("ExperimentParameters");return(0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,[e.errorMessage?((0,n.openBlock)(),(0,n.createBlock)(c,{key:0,autohide:!0,fade:!0,onHidden:e.clearErrorMessage},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{closeButton:""},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Error ")]),void 0,!0),_:1}),(0,n.createVNode)(s,null,{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(e.errorMessage),1)]),void 0,!0),_:1})]),void 0,!0),_:1},8,["onHidden"])):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",Qe,[(0,n.createElementVNode)("div",Je,[(0,n.createVNode)(u,{class:"flex-grow-1 mt-3"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(d,{modelValue:r.currentExperimentId,"onUpdate:modelValue":t[0]||(t[0]=e=>r.currentExperimentId=e),id:"floatingSelect",floatingLabel:"Select Experiment","aria-label":"Floating label select example",onChange:i.handleExperimentSelected},{default:(0,n.withCtx)((()=>[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.reversedExperiments,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("option",{key:e.id,value:e.id},(0,n.toDisplayString)(e.name),9,Ze)))),128))]),void 0,!0),_:1},8,["modelValue","onChange"])]),void 0,!0),_:1}),(0,n.createVNode)(m,{color:"primary",onClick:i.handleNewExperimentButton,class:"mt-3 ml-3"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("+")]),void 0,!0),_:1},8,["onClick"]),(0,n.createElementVNode)("div",et,[(0,n.createVNode)(m,{class:(0,n.normalizeClass)(["start-button",{active:"running"===e.currentExperiment.status}]),style:(0,n.normalizeStyle)({"background-color":"running"===e.currentExperiment.status?"#28a745":"transparent"}),onClick:t[1]||(t[1]=t=>e.startExperiment()),color:"success",title:"Start the experiment loop - measure OD every minute and dilute the cultures as necessary, according to the parameters."},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Start ")]),void 0,!0),_:1},8,["class","style"]),(0,n.createVNode)(m,{class:(0,n.normalizeClass)(["start-button",{active:"paused"===e.currentExperiment.status}]),style:(0,n.normalizeStyle)({"background-color":"paused"===e.currentExperiment.status?"#ffc107":"transparent"}),onClick:t[2]||(t[2]=t=>e.pauseExperiment()),title:"Pause the dilutions, but keep measuring the OD every minute.",color:"warning"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Pause ")]),void 0,!0),_:1},8,["class","style"]),(0,n.createVNode)(m,{class:(0,n.normalizeClass)(["start-button",{active:"stopped"===e.currentExperiment.status}]),style:(0,n.normalizeStyle)({"background-color":"stopped"===e.currentExperiment.status?"#dc3545":"transparent"}),onClick:t[3]||(t[3]=t=>e.stopExperiment()),onDblclick:t[4]||(t[4]=t=>e.forceStopExperiment()),color:"danger",title:"Stop gracefully - wait for the current dilution to finish."},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Stop ")]),void 0,!0),_:1},8,["class","style"])])]),r.showCreate?((0,n.openBlock)(),(0,n.createElementBlock)("div",tt,[r.showCreate?((0,n.openBlock)(),(0,n.createBlock)(u,{key:0,class:"new-experiment"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(p,{"model-value":r.newExperimentname,"onUpdate:modelValue":t[5]||(t[5]=e=>r.newExperimentname=e),id:"floatingInput",floatingLabel:"New Experiment Name"},null,8,["model-value"])]),void 0,!0),_:1})):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(m,{color:"success",onClick:i.createAndSelectExperiment,class:"ml-3 mt-3"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("Create Experiment")]),void 0,!0),_:1},8,["onClick"])])):(0,n.createCommentVNode)("",!0),e.currentExperiment?((0,n.openBlock)(),(0,n.createElementBlock)("div",at,[(0,n.createVNode)(h)])):(0,n.createCommentVNode)("",!0)])],64)}const ot={class:"experiment-parameters"},rt={class:"stock-parameters"};function it(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CFormInput"),s=(0,n.resolveComponent)("CFormFloating");return(0,n.openBlock)(),(0,n.createElementBlock)("div",ot,[(0,n.createElementVNode)("div",rt,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(e.currentExperiment.parameters,((t,a)=>((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:a},["cultures"!==a&&"growth_parameters"!==a?((0,n.openBlock)(),(0,n.createBlock)(s,{key:0,class:"stock-parameter-field"},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{class:(0,n.normalizeClass)({active:"running"!==e.currentExperiment.status}),"model-value":t,"onUpdate:modelValue":t=>e.currentExperiment.parameters[a]=t,id:`floatingInput_${a}`,"floating-label":`${a}`,placeholder:`Enter ${a}`,readonly:"running"===e.currentExperiment.status,onChange:e=>i.handleInputChange(a,e.target.value)},null,8,["class","model-value","onUpdate:modelValue","id","floating-label","placeholder","readonly","onChange"])]),void 0,!0),_:2},1024)):(0,n.createCommentVNode)("",!0)],64)))),128))])])}var lt={components:{CFormFloating:N.SR,CFormInput:N.OG},computed:{...(0,c.aH)("experiment",["currentExperiment"])},methods:{...(0,c.i0)("experiment",["updateExperimentParameters"]),async handleInputChange(e,t){await this.updateExperimentParameters({experimentId:this.currentExperiment.id,parameters:{...this.currentExperiment.parameters,[e]:t}})}}};const st=(0,$.A)(lt,[["render",it],["__scopeId","data-v-1fc42baa"]]);var ct=st,dt={components:{ExperimentParameters:ct,CButton:N.Q_,CFormFloating:N.SR,CFormInput:N.OG,CFormSelect:N.MT,CToast:N.JY,CToastBody:N.Bw,CToastHeader:N.hk},data(){return{newExperimentname:null,showCreate:!1,currentExperimentId:null}},computed:{...(0,c.aH)("experiment",["experiments","currentExperiment","errorMessage"]),reversedExperiments(){return[...this.experiments].reverse()}},methods:{...(0,c.i0)("experiment",["setCurrentExperimentAction","createExperiment","fetchExperiments","fetchCurrentExperiment","startExperiment","pauseExperiment","stopExperiment"]),async handleExperimentSelected(e){"running"!==this.currentExperiment.status&&"paused"!==this.currentExperiment.status||await this.stopExperiment(this.currentExperiment.id);const t=e.target.value;t!==this.currentExperimentId&&(this.currentExperimentId=t,await this.setCurrentExperimentAction(this.currentExperimentId))},async handleNewExperimentButton(){this.showCreate=!this.showCreate,"running"!==this.currentExperiment.status&&"paused"!==this.currentExperiment.status||await this.stopExperiment(this.currentExperiment.id)},async createAndSelectExperiment(){this.currentExperiment?this.currentExperimentId=await this.createExperiment({name:this.newExperimentname,parameters:this.currentExperiment.parameters}):this.currentExperimentId=await this.createExperiment({name:this.newExperimentname}),await this.handleExperimentSelected({target:{value:this.currentExperimentId}}),this.showCreate=!1,this.newExperimentname=""}},async created(){await this.fetchExperiments(),await this.fetchCurrentExperiment(),this.currentExperimentId=this.currentExperiment.id}};const ut=(0,$.A)(dt,[["render",nt],["__scopeId","data-v-7cb84220"]]);var mt=ut;const pt={id:"CulturePlot"},ht={class:"control-container"},gt={class:"button-row"},vt={class:"button-container"};function bt(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CButton"),s=(0,n.resolveComponent)("VialPlot");return(0,n.openBlock)(),(0,n.createElementBlock)("div",pt,[(0,n.createElementVNode)("div",ht,[(0,n.createElementVNode)("div",gt,[(0,n.createVNode)(l,{class:"plot-button",color:"success",onClick:i.plotAllData},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("Plot Data")]),void 0,!0),_:1},8,["onClick"]),(0,n.createElementVNode)("div",vt,[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.vials,(t=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:t,class:"button-item"},[(0,n.createVNode)(l,{color:e.selectedVials[t]?"primary":"secondary",style:(0,n.normalizeStyle)({"background-color":e.selectedVials[t]?"#007bff":"transparent"}),onClick:e=>i.toggleVial(t,e),id:`vial-button-${t}`},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)((0,n.toDisplayString)(`Vial ${t}`),1)]),void 0,!0),_:2},1032,["color","style","onClick","id"])])))),128))])])]),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(i.filteredVials,(t=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:t},[(0,n.createVNode)(s,{vial:t,data:e.plot_data[t]},null,8,["vial","data"])])))),128))])}const Ct=["id"];function xt(e,t,a,o,r,i){return(0,n.openBlock)(),(0,n.createElementBlock)("div",{id:`vial-${a.vial}`,class:"graph-container"},null,8,Ct)}var kt=a(28850),Et=a.n(kt),ft={name:"VialPlot",props:{vial:{type:Number,required:!0},data:{type:Array,default:()=>[]}},watch:{data:{handler:"plotData",deep:!0}},mounted(){this.plotData()},methods:{plotData(){const e=this.data||[];let t=0,a=0,n=0,o=0,r=0;e.forEach((e=>{const i=Math.max(...e.y);switch(e.yaxis){case"y5":i>t&&(t=i);break;case"y":i>a&&(a=i);break;case"y2":i>n&&(n=i);break;case"y3":i>o&&(o=i);break;case"y4":i>r&&(r=i);break}}));const i=t<=4e3?[0,4e3]:[0,1.05*t],l=a<=1?[0,1]:[0,1.05*a],s=n<=50?[0,50]:[0,1.05*n],c=o<=10?[0,10]:[0,1.05*o],d=r<=1.5?[0,1.5]:[0,1.05*r],u={title:`Culture ${this.vial}`,xaxis:{title:"Time"},yaxis:{title:"Optical Density",range:l,automargin:!0,mode:"lines+markers"},yaxis2:{title:"Generation",range:s,overlaying:"y",side:"right",automargin:!0},yaxis3:{title:"Concentration",range:c,overlaying:"y",side:"right",position:.92,automargin:!0},yaxis4:{title:"Growth Rate",range:d,overlaying:"y",side:"left",position:.08,automargin:!0},yaxis5:{title:"RPM",range:i,overlaying:"y",side:"right",position:.1,automargin:!0}},m=document.getElementById(`vial-${this.vial}`);m&&Et().react(m,e,u)}}};const yt=(0,$.A)(ft,[["render",xt],["__scopeId","data-v-1e73f020"]]);var Vt=yt,wt={components:{CButton:N.Q_,VialPlot:Vt},name:"ExperimentChart",computed:{...(0,c.aH)("experiment",["currentExperiment","selectedVials","plot_data"]),filteredVials(){return this.vials.filter((e=>this.selectedVials[e]))}},data(){return{vials:[1,2,3,4,5,6,7]}},methods:{...(0,c.i0)("experiment",["fetchCulturePlot","setSelectedVials"]),async plotAllData(){if(this.currentExperiment)for(let e of this.filteredVials)await this.fetchCulturePlot(e)},async toggleVial(e,t){let a;a=t.ctrlKey?{[e]:!0}:{...this.selectedVials,[e]:!this.selectedVials[e]},this.setSelectedVials(a),a[e]&&await this.fetchCulturePlot(e)}},mounted(){this.plotAllData()}};const Nt=(0,$.A)(wt,[["render",bt],["__scopeId","data-v-83a7e7cc"]]);var Bt=Nt,St={components:{ExperimentSetup:mt,ExperimentChart:Bt},computed:{...(0,c.aH)("experiment",["experiments","currentExperiment","errorMessage"])}};const _t=(0,$.A)(St,[["render",We]]);var Dt=_t;const jt=(0,n.createElementVNode)("a",{style:{"margin-left":"30px"},href:"https://dashboard.ngrok.com/get-started/your-authtoken",target:"_blank"},"Get ngrok authtoken",-1),It=(0,n.createElementVNode)("br",null,null,-1),Tt=(0,n.createElementVNode)("br",null,null,-1),Pt=["href"];function At(e,t,a,o,r,i){return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.withDirectives)((0,n.createElementVNode)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>r.authtoken=e),placeholder:"ngrok authtoken"},null,512),[[n.vModelText,r.authtoken]]),(0,n.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>i.sendAuthtoken&&i.sendAuthtoken(...e))},"Connect"),jt,It,Tt,(0,n.createElementVNode)("p",null,[(0,n.createTextVNode)("Ngrok URL: "),(0,n.createElementVNode)("a",{href:r.ngrokUrl,target:"_blank"},(0,n.toDisplayString)(r.ngrokUrl),9,Pt)])])}var Ot=a(94335);const Ft=Ot.A.create({baseURL:window.location.origin+"/tunnels",timeout:15e3});console.log("Created ngrokAxios with baseURL: "+window.location.origin+"/tunnels");var Mt={data(){return{authtoken:"",ngrokUrl:""}},created(){Ft.get("/get-ngrok-url").then((e=>{console.log(e),this.ngrokUrl=e.data.ngrokUrl})).catch((e=>{console.log(e)}))},methods:{sendAuthtoken(){Ft.post("/set-ngrok-authtoken",{authtoken:this.authtoken}).then((e=>{console.log(e),this.ngrokUrl=e.data.ngrokUrl})).catch((e=>{console.log(e)}))}}};const Lt=(0,$.A)(Mt,[["render",At]]);var Rt=Lt;const zt={class:"documentation"},Ht=["src"];function $t(e,t,a,o,r,i){return(0,n.openBlock)(),(0,n.createElementBlock)("div",zt,[(0,n.createElementVNode)("div",null,[(0,n.createElementVNode)("iframe",{src:r.docUrl,class:"documentation-frame"},null,8,Ht)])])}var Ut={data(){return{docUrl:"https://docs.replifactory.com"}}};const qt=(0,$.A)(Ut,[["render",$t],["__scopeId","data-v-14d1b770"]]);var Gt=qt;const Yt={class:"d-flex justify-content-start mt-3"},Xt={class:"d-flex flex-wrap mt-3"},Kt=(0,n.createElementVNode)("div",{class:"d-flex align-items-center mr-3"}," Export Data ",-1),Wt=(0,n.createElementVNode)("option",{disabled:"",value:""},"Please select a format",-1),Qt=(0,n.createElementVNode)("option",null,"csv",-1),Jt=(0,n.createElementVNode)("option",null,"html",-1),Zt={class:"mt-3"},ea=["src"],ta=["innerHTML"];function aa(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CIcon"),s=(0,n.resolveComponent)("CButton"),c=(0,n.resolveComponent)("CFormSelect");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.createElementVNode)("div",Yt,[(0,n.createVNode)(s,{color:"info",class:"mr-3",onClick:i.capture_image},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{icon:r.cilCamera,size:"xl"},null,8,["icon"]),(0,n.createTextVNode)(" photo ")]),void 0,!0),_:1},8,["onClick"]),(0,n.createVNode)(s,{color:"success",class:"mr-3",onClick:i.download_db},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{icon:r.cilCloudDownload,size:"xl"},null,8,["icon"]),(0,n.createTextVNode)(" download database ")]),void 0,!0),_:1},8,["onClick"]),(0,n.createVNode)(s,{color:"primary",onClick:i.get_info},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(l,{icon:r.cilInfo,size:"xl"},null,8,["icon"])]),void 0,!0),_:1},8,["onClick"])]),(0,n.createElementVNode)("div",Xt,[Kt,(0,n.createVNode)(c,{"model-value":r.selectedFormat,"onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedFormat=e),class:"mr-3"},{default:(0,n.withCtx)((()=>[Wt,Qt,Jt]),void 0,!0),_:1},8,["model-value"]),(0,n.createElementVNode)("div",null,[((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(7,(e=>(0,n.createVNode)(s,{color:"info",key:"vial"+e,class:"mr-1",onClick:t=>i.export_data(e,r.selectedFormat)},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Vial "+(0,n.toDisplayString)(e),1)]),void 0,!0),_:2},1032,["onClick"]))),64))])]),(0,n.createElementVNode)("div",Zt,[(0,n.createElementVNode)("img",{src:r.camera_image,class:"img-fluid"},null,8,ea)]),(0,n.createElementVNode)("div",{class:"mt-3",innerHTML:r.status_text},null,8,ta)])}a(16573),a(78100),a(77936),a(37467),a(44732),a(79577),a(64979),a(14603),a(47566),a(98721);let na=window.location.origin+"/api";const oa=Ot.A.create({baseURL:na});var ra=oa,ia=a(7321),la=a(33983),sa=a(60068),ca=a(55310),da=a(4328),ua={components:{CButton:N.Q_,CIcon:ia.l,CFormSelect:N.MT},name:"StatusTab",data(){return{status_text:"",msg:"StatusTab",camera_image:null,selectedFormat:"html",cilCamera:la.u,cilCloudDownload:sa.s,cilGraph:ca.f,cilInfo:da.v}},methods:{download_db:function(){ra.get("/download_db",{responseType:"blob"}).then((e=>{const t=new Blob([e.data],{type:"application/octet-stream"}),a=document.createElement("a");a.href=URL.createObjectURL(t),a.download=document.title+"_replifactory.db",document.body.appendChild(a),a.click(),document.body.removeChild(a)})).catch((e=>{console.error(e)}))},get_info:function(){ra.get("/status").then((e=>{this.status_text=e.data.replace(/\n/g,"<br />")})).catch((e=>{console.error(e)}))},export_data:function(e,t){ra.get(`/export/${e}/${t}`,{responseType:"blob"}).then((a=>{const n=new Blob([a.data],{type:"application/octet-stream"}),o=document.createElement("a");o.href=URL.createObjectURL(n),o.download=`vial_${e}_data.${t}`,document.body.appendChild(o),o.click(),document.body.removeChild(o)})).catch((e=>{console.error(e)}))},capture_image:function(){ra.get("/capture",{responseType:"arraybuffer"}).then((e=>{const t=btoa(new Uint8Array(e.data).reduce(((e,t)=>e+String.fromCharCode(t)),""));this.camera_image="data:image/jpeg;base64,"+t})).catch((e=>{console.error(e)}))}}};const ma=(0,$.A)(ua,[["render",aa]]);var pa=ma;const ha={class:"d-flex align-items-center mt-3"};function ga(e,t,a,o,r,i){const l=(0,n.resolveComponent)("CButton"),s=(0,n.resolveComponent)("CFormInput"),c=(0,n.resolveComponent)("CFormFloating");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.createElementVNode)("div",ha,[(0,n.createVNode)(l,{color:"info",class:"btn mt-3",style:{width:"20%"},onClick:i.fetchLogTails},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)(" Get Logs ")]),void 0,!0),_:1},8,["onClick"]),(0,n.createVNode)(c,{class:"mt-3 ml-3",style:{width:"20%"}},{default:(0,n.withCtx)((()=>[(0,n.createVNode)(s,{type:"number",style:{"background-color":"transparent",border:"none"},id:"floatingInput",value:i.formatNumber(r.lines),floatingLabel:"Number of Lines"},null,8,["value"])]),void 0,!0),_:1})]),((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.logs,((e,t)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:t,class:"mt-3"},[(0,n.createElementVNode)("h3",null,(0,n.toDisplayString)(t),1),(0,n.createElementVNode)("pre",null,(0,n.toDisplayString)(e),1)])))),128))])}var va={components:{CButton:N.Q_,CFormInput:N.OG,CFormFloating:N.SR},data(){return{lines:100,logs:{}}},methods:{formatNumber(e){return null!==e?e.toFixed(0):"N/A"},fetchLogTails(){ra.get(`/log/${this.lines}/`).then((e=>{this.logs=e.data}))}},mounted(){this.fetchLogTails()}};const ba=(0,$.A)(va,[["render",ga]]);var Ca=ba;const xa=e=>((0,n.pushScopeId)("data-v-ebdb4066"),e=e(),(0,n.popScopeId)(),e),ka={key:0},Ea={class:"container-wrapper"},fa={class:"tables-container"},ya={class:"table-wrapper"},Va={class:"table-wrapper"},wa={id:"SimulationPlot"},Na={class:"controls-container"},Ba=["value"],Sa={key:1,class:"no-experiment-selected"},_a=xa((()=>(0,n.createElementVNode)("p",null,"No experiment selected",-1))),Da=[_a];function ja(e,t,a,o,r,i){const l=(0,n.resolveComponent)("TableComponent"),s=(0,n.resolveComponent)("GrowthParameters"),c=(0,n.resolveComponent)("CButton"),d=(0,n.resolveComponent)("VialPlot");return e.currentExperiment.parameters?((0,n.openBlock)(),(0,n.createElementBlock)("div",ka,[(0,n.createElementVNode)("div",Ea,[(0,n.createElementVNode)("div",fa,[(0,n.createElementVNode)("div",ya,[((0,n.openBlock)(),(0,n.createBlock)(l,{class:"control-parameters",key:e.currentExperiment.id,fetchData:i.fetchCulturesData,updateData:i.updateCulturesData,tableTitle:"Culture Control Parameters",columnHeaders:["Vial 1","Vial 2","Vial 3","Vial 4","Vial 5","Vial 6","Vial 7"],rowHeaderLabel:"Parameter",rowHeaderWidth:270},null,8,["fetchData","updateData"]))]),(0,n.createElementVNode)("div",Va,[(0,n.createVNode)(s,{class:"growth-parameters"})])])]),(0,n.createElementVNode)("div",wa,[(0,n.createElementVNode)("div",Na,[(0,n.createVNode)(c,{color:"info",onClick:i.plotSelectedVial,class:"control-button"},{default:(0,n.withCtx)((()=>[(0,n.createTextVNode)("Plot Predicted Experiment")]),void 0,!0),_:1},8,["onClick"]),(0,n.withDirectives)((0,n.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedVial=e),class:"form-select control-dropdown"},[((0,n.openBlock)(!0),(0,n.createElementBlock)(n.Fragment,null,(0,n.renderList)(r.vials,(e=>((0,n.openBlock)(),(0,n.createElementBlock)("option",{key:e,value:e}," Vial "+(0,n.toDisplayString)(e),9,Ba)))),128))],512),[[n.vModelSelect,r.selectedVial]])]),r.selectedVial?((0,n.openBlock)(),(0,n.createBlock)(d,{key:0,vial:r.selectedVial,data:e.simulation_data[r.selectedVial]},null,8,["vial","data"])):(0,n.createCommentVNode)("",!0)])])):((0,n.openBlock)(),(0,n.createElementBlock)("div",Sa,Da))}const Ia={key:0},Ta={ref:"hotTable",class:"hot-table"};function Pa(e,t,a,o,r,i){return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[a.tableTitle?((0,n.openBlock)(),(0,n.createElementBlock)("h3",Ia,(0,n.toDisplayString)(a.tableTitle),1)):(0,n.createCommentVNode)("",!0),(0,n.createElementVNode)("div",Ta,null,512)])}var Aa=a(20781),Oa=(a(19830),{props:{fetchData:{type:Function,required:!0},updateData:{type:Function,required:!0},tableTitle:{type:String,default:""},columnHeaders:{type:Array,default:()=>[]},rowHeaderLabel:{type:String,default:"Row"},rowHeaderWidth:{type:Number,default:200}},mounted(){this.loadTableData()},methods:{async loadTableData(){const{data:e,keys:t}=await this.fetchData(),a=this.$refs.hotTable;this.hot=new Aa.Ay(a,{data:e,colHeaders:this.columnHeaders,rowHeaders:t,contextMenu:!0,afterChange:this.handleTableChange,licenseKey:"non-commercial-and-evaluation",manualColumnResize:!0,rowHeaderWidth:this.rowHeaderWidth})},async handleTableChange(e){if(e){const e=this.hot.getData();await this.updateFullTable(e)}},async updateFullTable(e){console.log("Updating full table:",e);try{await this.updateData(e),console.log("Full table update successful")}catch(t){console.error("Full table update failed:",t)}}}});const Fa=(0,$.A)(Oa,[["render",Pa]]);var Ma=Fa;const La={key:0};function Ra(e,t,a,o,r,i){const l=(0,n.resolveComponent)("TableComponent");return Object.keys(e.currentExperiment?.parameters?.growth_parameters||{}).length>0?((0,n.openBlock)(),(0,n.createElementBlock)("div",La,[((0,n.openBlock)(),(0,n.createBlock)(l,{key:e.currentExperiment.id,fetchData:i.fetchCulturesData,updateData:i.updateCulturesData,tableTitle:"Culture Growth Parameters",columnHeaders:["Vial 1","Vial 2","Vial 3","Vial 4","Vial 5","Vial 6","Vial 7"],rowHeaderLabel:"Parameter",rowHeaderWidth:270},null,8,["fetchData","updateData"]))])):(0,n.createCommentVNode)("",!0)}var za={components:{TableComponent:Ma},computed:{...(0,c.aH)("experiment",["currentExperiment"])},methods:{...(0,c.i0)("experiment",["updateExperimentParameters"]),async handleInputChange(e,t){await this.updateExperimentParameters({experimentId:this.currentExperiment.id,parameters:{...this.currentExperiment.parameters,[e]:t}})},fetchCulturesData(){const e=this.currentExperiment.parameters.growth_parameters,t=Object.keys(e[1]),a=["initial_population","doubling_time_mins","carrying_capacity","mu_min","ic50_initial","ic10_ic50_ratio","dose_effective_slope_width_mins","time_lag_drug_effect_mins","adaptation_rate_max","adaptation_rate_ic10_ic50_ratio","drug_concentration","effective_dose"],n=e=>{const t=new Set(a),n=a.filter((t=>e.includes(t))),o=e.filter((e=>!t.has(e))).sort();return[...n,...o]},o=n(t),r=o.map((t=>Object.keys(e).map((a=>e[a][t]))));return{data:r,keys:o}},async updateCulturesData(e){const t=this.fetchCulturesData().keys,a=Object.keys(this.currentExperiment.parameters.growth_parameters);for(let n=0;n<a.length;n++)for(let o=0;o<t.length;o++)this.currentExperiment.parameters.growth_parameters[a[n]][t[o]]=e[o][n];await this.updateExperimentParameters({experimentId:this.currentExperiment.id,parameters:this.currentExperiment.parameters})}}};const Ha=(0,$.A)(za,[["render",Ra]]);var $a=Ha,Ua={components:{GrowthParameters:$a,TableComponent:Ma,VialPlot:Vt,CButton:N.Q_},data(){return{vials:Array.from({length:7},((e,t)=>t+1)),selectedVial:1,errorMessage:"This is a test error message."}},computed:{...(0,c.aH)("experiment",["simulation_data","currentExperiment"])},methods:{...(0,c.i0)("experiment",["fetchSimulationPlot","updateExperimentParameters"]),fetchCulturesData(){const e=this.currentExperiment.parameters.cultures,t=Object.keys(e[1]),a=["name","description","volume_vial","pump1_stock_drug_concentration","pump2_stock_drug_concentration","dose_initialization","dilution_factor","od_dilution_threshold","delay_dilution_max_hours","dilution_number_first_drug_addition","dose_first_drug_addition","dose_increase_factor","dose_increase_amount","delay_stress_increase_min_generations","threshold_od_min_increase_stress","threshold_growth_rate_increase_stress","threshold_growth_rate_decrease_stress"],n=e=>{const t=new Set(a),n=a.filter((t=>e.includes(t))),o=e.filter((e=>!t.has(e))).sort();return[...n,...o]},o=n(t),r=o.map((t=>Object.keys(e).map((a=>e[a][t]))));return{data:r,keys:o}},async updateCulturesData(e){const t=this.fetchCulturesData().keys,a=Object.keys(this.currentExperiment.parameters.cultures),n=t;for(let o=0;o<a.length;o++)for(let t=0;t<n.length;t++)this.currentExperiment.parameters.cultures[a[o]][n[t]]=e[t][o];await this.updateExperimentParameters({experimentId:this.currentExperiment.id,parameters:this.currentExperiment.parameters})},async plotSelectedVial(){this.currentExperiment&&this.selectedVial&&await this.fetchSimulationPlot(this.selectedVial)}}};const qa=(0,$.A)(Ua,[["render",ja],["__scopeId","data-v-ebdb4066"]]);var Ga=qa,Ya={name:"App",computed:{...(0,c.aH)(["hostname"])},async mounted(){await this.$store.dispatch("fetchHostname"),document.title=this.hostname},components:{ExperimentTab:Dt,DeviceControl:Ke,NgrokTab:Rt,HelpTab:Gt,StatusTab:pa,LogsTab:Ca,PredictionTab:Ga},data(){return{currentTab:"Experiment",tabs:["Experiment","Prediction","Device","Remote","Help","Status","Logs"]}}};const Xa=(0,$.A)(Ya,[["render",s]]);var Ka=Xa,Wa={namespaced:!0,state:{calibrationModeEnabled:!1,valves:{states:{1:"open",2:"open",3:"open",4:"open",5:"open",6:"open",7:"open"}},pumps:{states:{1:"stopped",2:"stopped",3:"stopped"},volume:{1:null,2:null,3:null,4:null},calibration:{1:{1:.2,5:.19,10:.18,50:.17},2:{1:.2,5:.19,10:.18,50:.17},3:{1:.2,5:.19,10:.18,50:.17},4:{1:.2,5:.19,10:.18,50:.17}}},stirrers:{states:{1:"stopped",2:"high",3:"low",4:"stopped",5:"stopped",6:"stopped",7:"stopped"},calibration:{1:{low:.4,high:.5},2:{low:.4,high:.5},3:{low:.4,high:.5},4:{low:.4,high:.5},5:{low:.4,high:.5},6:{low:.4,high:.5},7:{low:.4,high:.5}}},ods:{states:{1:0,2:0,3:0,4:0,5:0,6:0,7:0},odsignals:{1:0,2:0,3:0,4:0,5:0,6:0,7:0},calibration_coefs:{1:[4,1,10,-.5,4],2:[4,1,10,-.5,4],3:[4,1,10,-.5,4],4:[4,1,10,-.5,4],5:[4,1,10,-.5,4],6:[4,1,10,-.5,4],7:[4,1,10,-.5,4]},calibration:{1:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},2:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},3:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},4:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},5:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},6:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648},7:{.00788:40.375,.0158:39.781,.0315:38.664,.063:36.508,.126:32.789,.252:26.75,.504:18.367,1.01:9.719,2.02:3.961,4.03:1.648}}},thermometers:{states:{1:0,2:0}}},mutations:{setPartCalibration(e,{devicePart:t,partIndex:a,newCalibration:n,coefs:o}){e[t].calibration[a]=n,o&&(e[t].calibration_coefs[a]=o)},setPartState(e,{devicePart:t,partIndex:a,newState:n}){e[t].states[a]=n},setAllDeviceStates(e,t){e.valves=t.valves,e.pumps=t.pumps,e.stirrers=t.stirrers,e.ods=t.ods,e.odsignals=t.odsignals,e.temperatures=t.temperatures},toggleCalibrationMode(e){e.calibrationModeEnabled=!e.calibrationModeEnabled},removeODCalibrationRow(e,t){const a=Object.keys(e.ods.calibration);a.forEach((a=>{delete e.ods.calibration[a][t]}))},updateODCalibrationValue(e,{od:t,odsIndex:a,newValue:n}){""===n?delete e.ods.calibration[a][t]:e.ods.calibration[a][t]=parseFloat(n)},updateODCalibrationKey(e,{oldOD:t,newOD:a}){console.log(t,a,"change");for(let n=1;n<=7;n++)e.ods.calibration[n]&&e.ods.calibration[n][t]&&(e.ods.calibration[n][a]=e.ods.calibration[n][t],delete e.ods.calibration[n][t])},setDeviceControlEnabled(e,t){e.deviceControlEnabled=t}},actions:{setAllStirrersStateAction({dispatch:e,state:t},a){Object.keys(t.stirrers.states).forEach((t=>{e("setPartStateAction",{devicePart:"stirrers",partIndex:parseInt(t),newState:a})}))},async updateODCalibrationKeyAction({dispatch:e,commit:t,state:a},n){const{oldOD:o,newOD:r}=n;await t("updateODCalibrationKey",{oldOD:o,newOD:r}),console.log(r,a.ods.calibration[1]);for(let i=1;i<=7;i++)await e("setPartCalibrationAction",{devicePart:"ods",partIndex:i,newCalibration:a.ods.calibration[i]}).catch((e=>console.error("Error dispatching setPartCalibrationAction:",e)))},async updateODCalibrationValueAction({dispatch:e,commit:t,state:a},n){const o=n.odsIndex;await t("updateODCalibrationValue",n),await e("setPartCalibrationAction",{devicePart:"ods",partIndex:o,newCalibration:a.ods.calibration[o]}).catch((e=>console.error("Error during updateODCalibrationValueAction:",e)))},async removeODCalibrationRowAction({dispatch:e,commit:t,state:a},n){try{t("removeODCalibrationRow",n);for(let t=1;t<=7;t++)await e("setPartCalibrationAction",{devicePart:"ods",partIndex:t,newCalibration:a.ods.calibration[t]}),console.log(a.ods.calibration[t]," setPartCalibrationAction***********************")}catch(o){console.error("Error removing OD calibration row:",o)}},setPartCalibrationAction({commit:e},t){const{devicePart:a,partIndex:n,newCalibration:o}=t,r=`/set-${a}-calibration`;for(let i in o)null===o[i]&&delete o[i];return new Promise(((t,i)=>{ra.post(r,{partIndex:n,newCalibration:o}).then((o=>{o.data.success?(console.log(o.data,"response.data from setpartcalibrationaction"),e("setPartCalibration",{devicePart:a,partIndex:n,newCalibration:o.data.newCalibration,coefs:o.data.coefs}),t()):(console.error(`Error updating ${a} calibration:`,o.data.message),i())})).catch((e=>{console.error(`Error updating ${a} calibration:`,e),i()}))}))},measureODCalibrationAction({dispatch:e},t){const{odValue:a}=t,n="/measure-od-calibration";return new Promise(((t,o)=>{ra.post(n,{odValue:parseFloat(a)}).then((a=>{a.data.success&&e("getAllDeviceData").then((()=>{t()}))})).catch((e=>{console.error("Error updating od calibration:",e),o()}))}))},startPumpCalibrationSequence({dispatch:e},t){const{pumpId:a,rotations:n,iterations:o}=t,r="pumps",i="/start-pump-calibration-sequence";return console.log("startPumpCalibrationSequence",t),new Promise(((t,l)=>{ra.post(i,{pumpId:a,rotations:n,iterations:o}).then((n=>{n.data.success?e("setPartStateAction",{devicePart:r,partIndex:a,newState:"stopped"}).then((()=>{t()})):(console.error(`Error updating ${r} calibration:`,n.data.message),l())})).catch((e=>{console.error(`Error updating ${r} calibration:`,e),l()}))}))},setPartStateAction({commit:e},t){const{devicePart:a,partIndex:n,newState:o,input:r}=t,i=`/set-${a}-state`;return e("setPartState",{devicePart:a,partIndex:n,newState:o}),new Promise(((e,t)=>{ra.post(`${i}`,{partIndex:n,newState:o,input:r}).then((a=>{a.data.success?e():t()})).catch((e=>{console.error(`Error updating ${a} state:`,e),t()}))}))},connect(){return new Promise(((e,t)=>{console.log("connect device request",ra),ra.post("/connect-device").then((a=>{a.data.success?e(a):(console.error("Error connecting device: server responded with error:",a),t())})).catch((e=>{console.error("Error connecting device:",e),t(e)}))}))},getAllDeviceData({commit:e}){return new Promise(((t,a)=>{ra.get("/get-all-device-data").then((n=>{n.data.success?(e("setAllDeviceStates",n.data.device_states),t()):(console.error("Error fetching device data: server responded with an error"),a())})).catch((e=>{console.error("Error fetching device data:",e),a(e)}))}))},measureDevicePart({commit:e},t){const{devicePart:a,partIndex:n}=t,o=`/measure-${a}`;return new Promise(((t,r)=>{ra.post(o,{partIndex:n}).then((n=>{n.data.success?(e("setAllDeviceStates",n.data.device_states),t()):(console.error(`Error measuring ${a}:`,n.data.message),r())})).catch((e=>{console.error(`Error measuring ${a}:`,e),r()}))}))}}},Qa={namespaced:!0,state:{audioContext:new(window.AudioContext||window.webkitAudioContext),hostname:"replifactory_GUI",errorMessage:null,experiments:[],currentExperiment:{id:null,name:null,parameters:null,data:{}},selectedVials:{1:!0,2:!0,3:!1,4:!1,5:!1,6:!1,7:!1},plot_data:{1:null,2:null,3:null,4:null,5:null,6:null,7:null},simulation_data:{1:null,2:null,3:null,4:null,5:null,6:null,7:null}},mutations:{setSelectedVials(e,t){e.selectedVials=t},setExperiments(e,t){e.experiments=t},setCurrentExperiment(e,t){e.currentExperiment=t},setExperimentPlotData(e,{data:t,vial:a}){e.plot_data[a]=t},setSimulationPlotData(e,{data:t,vial:a}){e.simulation_data[a]=t},setCurrentExperimentParameters(e,t){e.currentExperiment.parameters=t}},actions:{setSelectedVials({commit:e},t){e("setSelectedVials",t)},async fetchExperiments({commit:e}){console.log("fetchExperiments");const t=await ra.get("/experiments");e("setExperiments",t.data)},async fetchCulturePlot({commit:e,state:t},a){if(console.log(`fetchCulturePlot for vial ${a}`),!t.plot_data)return void console.log("Current experiment or its plot data is not defined");const n=await ra.get(`/plot/${a}`),o=n.data;e("setExperimentPlotData",{data:JSON.parse(o).data,vial:a})},async fetchSimulationPlot({commit:e,state:t},a){if(console.log(`fetchSimulationPlot for vial ${a}`),!t.plot_data)throw console.log("Current experiment or its plot data is not defined"),new Error("Current experiment or its plot data is not defined");try{const t=await ra.get(`/plot_simulation/${a}`),n=t.data;e("setSimulationPlotData",{data:JSON.parse(n).data,vial:a})}catch(n){console.error(n),alert(n.response.data.error)}},async setCurrentExperimentAction({commit:e,state:t},a){if(console.log("setCurrentExperimentAction"),a!==t.currentExperiment.id){const t=await ra.get(`/experiments/${a}`);e("setCurrentExperiment",t.data)}},async createExperiment({dispatch:e},t){console.log("createExperiment");const a=await ra.post("/experiments",t);return await e("fetchExperiments"),await e("setCurrentExperimentAction",a.data.id),a.data.id},async updateExperimentParameters({commit:e,state:t},{parameters:a}){console.log("updateExperimentParameters",t.currentExperiment.id,a),e("setCurrentExperimentParameters",a),await ra.put("/experiments/current/parameters",{parameters:t.currentExperiment.parameters})},async fetchCurrentExperiment({commit:e}){console.log("fetchCurrentExperiment");const t=await ra.get("/experiments/current");e("setCurrentExperiment",t.data)},async reloadExperimentParameters({commit:e}){const t=await ra.get("/experiments/current");e("setCurrentExperiment",t.data)},async startExperiment({dispatch:e}){console.log("startExperiment");try{const t=await ra.put("/experiments/current/status",{status:"running"});t.data.message?(console.log(t.data.message),e("reloadExperimentParameters"),e("playStartingExperimentSound")):t.data.error&&(console.error(t.data.error),this.errorMessage=t.data.error,e("playFailureSound"))}catch(t){console.error(t),e("playFailureSound"),this.errorMessage="An error occurred while starting the experiment."}},playFailureSound({state:e}){const t=750,a=e.audioContext.createOscillator();a.type="sine";const n=e.audioContext.createGain();return n.gain.setValueAtTime(.1,e.audioContext.currentTime),a.connect(n),n.connect(e.audioContext.destination),a.frequency.setValueAtTime(t,e.audioContext.currentTime),a.start(),n.gain.exponentialRampToValueAtTime(.001,e.audioContext.currentTime+.5),a.stop(e.audioContext.currentTime+.5),a},playStartingExperimentSound({state:e}){const t=[261.63,329.63,392,523.25],a=[.25,.25,.25,.55],n=[0,.2,.4,.6];t.forEach(((t,o)=>{setTimeout((()=>{const n=e.audioContext.createOscillator();n.type="sine";const r=e.audioContext.createGain();r.gain.setValueAtTime(.1,e.audioContext.currentTime),n.connect(r),r.connect(e.audioContext.destination),n.frequency.setValueAtTime(t,e.audioContext.currentTime),n.start(),r.gain.exponentialRampToValueAtTime(.001,e.audioContext.currentTime+a[o]),n.stop(e.audioContext.currentTime+a[o])}),1e3*n[o])}))},async pauseExperiment({dispatch:e,state:t}){"stopped"===t.currentExperiment.status&&await ra.put("/experiments/current/status",{status:"running"}),await ra.put("/experiments/current/status",{status:"paused"}),e("reloadExperimentParameters")},async stopExperiment({dispatch:e}){await ra.put("/experiments/current/status",{status:"stopped"}),e("reloadExperimentParameters"),e("playStopExperimentSound")},playStopExperimentSound({state:e}){const t=[523.25,392,329.63,261.63],a=[.25,.25,.25,.55],n=[0,.2,.4,.6];t.forEach(((t,o)=>{setTimeout((()=>{const n=e.audioContext.createOscillator();n.type="sine";const r=e.audioContext.createGain();r.gain.setValueAtTime(.1,e.audioContext.currentTime),n.connect(r),r.connect(e.audioContext.destination),n.frequency.setValueAtTime(t,e.audioContext.currentTime),n.start(),r.gain.exponentialRampToValueAtTime(.001,e.audioContext.currentTime+a[o]),n.stop(e.audioContext.currentTime+a[o])}),1e3*n[o])}))}}};n["default"].use(c.Ay);var Ja=new c.Ay.Store({state:{deviceConnected:!1,deviceControlEnabled:!0,experimentRunning:null,hostname:"replifactory_GUI"},modules:{device:Wa,experiment:Qa},mutations:{setExperiments(e,t){e.experiments=t},setDeviceConnected(e,t){e.deviceConnected=t},setHostname(e,t){e.hostname=t}},actions:{async fetchHostname({commit:e}){const t=await ra.get("/hostname");e("setHostname",t.data.hostname)},async connectDevice({dispatch:e,commit:t}){try{const a=await e("device/connect");a&&a.data.success?(await e("device/getAllDeviceData"),t("setDeviceConnected",!0)):t("setDeviceConnected",!1)}catch(a){console.log(a),t("setDeviceConnected",!1)}}}}),Za=a(39413),en=a(82625);const tn=(0,n.createApp)(Ka);tn.directive("click-outside",{beforeMount(e,t){e.clickOutsideEvent=a=>{e===a.target||e.contains(a.target)||a.target.classList.contains("input")||t.value()},document.addEventListener("click",e.clickOutsideEvent)},beforeUnmount(e){document.removeEventListener("click",e.clickOutsideEvent)}}),tn.use(Za.vGs).use(en.YS).use(Ja).mount("#app")},15340:function(){},79838:function(){}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,r){if(!n){var i=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],r=e[d][2];for(var l=!0,s=0;s<n.length;s++)(!1&r||i>=r)&&Object.keys(a.O).every((function(e){return a.O[e](n[s])}))?n.splice(s--,1):(l=!1,r<i&&(i=r));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,o,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,r,i=n[0],l=n[1],s=n[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(s)var d=s(a)}for(t&&t(n);c<i.length;c++)r=i[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},n=self["webpackChunkreplifactory"]=self["webpackChunkreplifactory"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],(function(){return a(84162)}));n=a.O(n)})();
//# sourceMappingURL=app.ad9adf55.js.map